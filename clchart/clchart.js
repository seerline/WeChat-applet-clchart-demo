!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define("ClChart",[],i):"object"==typeof exports?exports.ClChart=i():t.ClChart=i()}(window,function(){return function(t){var i={};function e(s){if(i[s])return i[s].exports;var h=i[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,e),h.l=!0,h.exports}return e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:s})},e.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=4)}([function(t,i,e){"use strict";function s(t,i){return("000000000"+t).slice(-1*(i=i>9?9:i))}function h(t){let i,e;return void 0===t?i=new Date:(e="string"==typeof t?parseInt(t):t,i=isNaN(e)?new Date:new Date(1e3*e)),i}function o(t){const i=h(t);return 1e4*i.getFullYear()+100*(i.getMonth()+1)+i.getDate()}function n(t){const i=h(t);return 100*i.getHours()+i.getMinutes()}function a(t){return new Date(Math.floor(t/1e4),Math.floor(t%1e4/100)-1,t%100).getDay()}function l(t){return new Date(Math.floor(t/1e4),Math.floor(t%1e4/100)-1,t%100).getMonth()+1}function r(t){return new Date(Math.floor(t/1e4),Math.floor(t%1e4/100)-1,t%100)/1e3}function c(t,i){return Math.floor((r(i)-r(t))/86400)}function d(t,i,e){const o=h(t);switch(i){case"minute":return void 0===e?o.getHours()+":"+s(o.getMinutes(),2):n(t)===n(e)?":"+s(o.getSeconds(),2):o.getHours()+":"+s(o.getMinutes(),2);case"datetime":return 1e4*o.getFullYear()+100*(o.getMonth()+1)+o.getDate()+"-"+o.getHours()+":"+s(o.getMinutes(),2);default:return""}}function f(t,i){return 60*(Math.floor(i/100)-Math.floor(t/100))+i%100-t%100}function u(t,i){const e=60*Math.floor(t/100)+t%100+i;return 100*Math.floor(e/60)+e%60}function m(t){let i;if(Array.isArray(t)){i=[];const e=t.length;for(let s=0;s<e;s++)i[s]=m(t[s])}else i=t;return i}function x(t){let i;if(t instanceof Object)if(Array.isArray(t))i=m(t);else{i={};for(const e in t)i[e]=x(t[e])}else i=t;return i}function g(t,i){let e;if(i instanceof Object)if(Array.isArray(i)){e=[];for(const s in i)e[s]=t&&t[s]?g(t[s],i[s]):m(i[s])}else{e={};for(const s in i)e[s]=t&&t[s]?g(t[s],i[s]):x(i[s])}else e=t||i;return e}function v(t){return!(void 0!==t&&Array.isArray(t)&&t.length>0)}function p(t,i){return void 0===t?{left:0,top:0,width:0,height:0}:void 0===i?t:{left:t.left+i.left,top:t.top+i.top,width:t.width-(i.left+i.right),height:t.height-(i.top+i.bottom)}}function y(t,i){return void 0!==t&&void 0!==i&&i.x>=t.left&&i.y>=t.top&&i.x<t.left+t.width&&i.y<t.top+t.height}function b(t,i){return void 0!==t&&void 0!==i&&i>=t.left&&i<t.left+t.width}function M(t,i){return void 0!==t&&void 0!==i&&i>=t.top&&i<t.top+t.height}function I(t,i){return!(i.indexOf(t)<0)}function w(t,i){const e=[];for(let s=0;s<t.length;s++)for(let h=0;h<i.length;h++)if(t[s]===i[h]){e.push(t[s]);break}return e}function D(t,i){if(void 0===t||isNaN(t))return"--";"string"==typeof t&&(t=parseFloat(t)),void 0===i&&(i=1);let e=t/i;return e=t>1e11?(t/1e8).toFixed(0)+"亿":t>1e10?(t/1e8).toFixed(1)+"亿":t>1e9?(t/1e8).toFixed(2)+"亿":t>1e8?(t/1e8).toFixed(3)+"亿":t>1e7?(t/1e4).toFixed(0)+"万":t>1e6?(t/1e4).toFixed(1)+"万":t>-1e-9&&t<1e-9?"--":t.toFixed(0),String(e)}function k(t,i,e,s){if(void 0===t||isNaN(t))return"--";let h=t;return(void 0===i||i<0||i>10)&&(i=0),t>-1e-9&&t<1e-9&&!s?"--":(h=h.toFixed(i),void 0===e||e<4?h:h.substr(0,e))}function O(t,i,e){let h=i;switch(t){case"M5":case"M15":case"M30":case"M60":h=d(i,"datetime");break;case"MIN":h=void 0===e?d(i,"minute"):function(t){return s(Math.floor(t/100),2).toString()+":"+s(t%100,2).toString()}(e);break;case"DAY5":h=d(i,"minute")}return h}function C(t,i,e,s){let h;return"rate"===i?h=function(t,i){if(void 0===t||isNaN(t)||void 0===i)return"--";"string"==typeof t&&(t=parseFloat(t));let e=Math.abs((t-i)/i*100);return e.toFixed(2)+"%"}(t,s):"price"===i?(void 0===e&&(e=2),h=k(t,e,7)):h=D(t,100),h}e.d(i,"h",function(){return o}),e.d(i,"l",function(){return n}),e.d(i,"k",function(){return a}),e.d(i,"j",function(){return l}),e.d(i,"i",function(){return c}),e.d(i,"g",function(){return d}),e.d(i,"m",function(){return f}),e.d(i,"n",function(){return u}),e.d(i,"a",function(){return m}),e.d(i,"b",function(){return x}),e.d(i,"v",function(){return g}),e.d(i,"t",function(){return v}),e.d(i,"u",function(){return p}),e.d(i,"r",function(){return y}),e.d(i,"p",function(){return b}),e.d(i,"q",function(){return M}),e.d(i,"o",function(){return I}),e.d(i,"s",function(){return w}),e.d(i,"f",function(){return D}),e.d(i,"d",function(){return k}),e.d(i,"e",function(){return O}),e.d(i,"c",function(){return C})},function(t,i,e){"use strict";e.d(i,"d",function(){return o}),e.d(i,"i",function(){return l}),e.d(i,"n",function(){return d}),e.d(i,"o",function(){return f}),e.d(i,"f",function(){return u}),e.d(i,"e",function(){return m}),e.d(i,"k",function(){return x}),e.d(i,"c",function(){return g}),e.d(i,"b",function(){return v}),e.d(i,"a",function(){return p}),e.d(i,"p",function(){return y}),e.d(i,"m",function(){return b}),e.d(i,"l",function(){return M}),e.d(i,"j",function(){return I}),e.d(i,"h",function(){return w}),e.d(i,"g",function(){return D});var s=e(2),h=e(0);function o({fields:t,value:i,coinunit:e},s,h=0){let n=0;try{let a=i;switch(Array.isArray(i[0])&&(a=i[h]),s){case"idx":n=void 0===t.idx?h:a[t.idx];break;case"coinunit":n=Math.pow(10,o({fields:t,value:i},"decimal",0));break;case"before":case"open":case"high":case"low":case"close":case"stophigh":case"stoplow":case"buy1":case"buy2":case"buy3":case"buy4":case"buy5":case"sell1":case"sell2":case"sell3":case"sell4":case"sell5":void 0===e&&(e=100),n=a[t[s]]/e;break;case"flow":case"total":n=100*a[t[s]];break;case"decvol":n=0===h?a[t.vol]:a[t.vol]-o({fields:t,value:i},"vol",h-1);break;case"decmoney":n=0===h?a[t.money]:a[t.money]-o({fields:t,value:i},"money",h-1);break;default:a[t[s]]&&(n=a[t[s]])}}catch(t){n=0}return n}function n(t){let i=1e3,e=0,h=0;return t[s.FIELD_RIGHT.accrual]&&(h=t[s.FIELD_RIGHT.accrual]/10),(t[s.FIELD_RIGHT.sendstock]>0||t[s.FIELD_RIGHT.allotstock]>0)&&(i=1e3+t[s.FIELD_RIGHT.sendstock]/10+t[s.FIELD_RIGHT.allotstock]/10,e=-t[s.FIELD_RIGHT.allotprice]*t[s.FIELD_RIGHT.allotstock]/1e4),{gs:i,pg:e,px:h}}function a(t,i,e,s){return void 0===i&&(i=100),(t="forword"===s?1e3*(t*(1e3/i)-e.pg-e.px)/e.gs:t*(1e3/i)*e.gs/1e3+e.pg+e.px)/(1e3/i)}function l(t,i,e,s,h){if(void 0===h||h.length<1)return e;let o;for(let l=0;l<h.length;l++)if(h[l][0]>t&&h[l][0]<=i){e=a(e,s,o=n(h[l]),"forword");break}return e}function r(t,i,e,h,o,l){const r=n(e);if("forword"===h)for(let e=o;e<l;e++)t[e][s.FIELD_DAY.open]=a(t[e][s.FIELD_DAY.open],i,r,h),t[e][s.FIELD_DAY.high]=a(t[e][s.FIELD_DAY.high],i,r,h),t[e][s.FIELD_DAY.low]=a(t[e][s.FIELD_DAY.low],i,r,h),t[e][s.FIELD_DAY.close]=a(t[e][s.FIELD_DAY.close],i,r,h),t[e][s.FIELD_DAY.vol]=t[e][s.FIELD_DAY.vol]*r.gs/1e3}function c(t,i,e){return e>t&&e<=i}function d(t,i,e,h,o,n){if(e.length<1||t.length<1)return t;if(void 0===h&&(h="forword"),(void 0===o||o<0||o>t.length-1)&&(o=0),(void 0===n||n<0)&&(n=t.length-1),"forword"===h)for(let a=o;a<=n;a++)for(let n=0;n<e.length;n++)if(!(a<1)&&c(t[a-1][s.FIELD_DAY.time],t[a][s.FIELD_DAY.time],e[n][s.FIELD_RIGHT.time])){r(t,i,e[n],h,o,a);break}return t}function f(t,i,e,o,n,a){if(e.length<1||t.length<1)return t;if(void 0===o&&(o="forword"),(void 0===n||n<0||n>t.length-1)&&(n=0),(void 0===a||a<0)&&(a=t.length-1),"forword"===o)for(let l=n;l<=a;l++)for(let a=0;a<e.length;a++)if(!(l<1)&&c(Object(h.h)(t[l-1][s.FIELD_DAY.time]),Object(h.h)(t[l][s.FIELD_DAY.time]),e[a][s.FIELD_RIGHT.time])){r(t,i,e[a],o,n,l);break}return t}function u(t,i){if(t.value.length<1)return{status:"new",index:-1};const e=t.value[t.value.length-1][t.fields.time];return e===i?{status:"old",index:t.value.length-1}:e>i?{status:"error",index:t.value.length-1}:{status:"new",index:t.value.length-1}}function m(t,i){return void 0===t||void 0===t.value||t.value.length<1?{finded:!1,index:-1}:i===t.value[t.value.length-1][t.fields.time]?{finded:!0,index:t.value.length-1}:{finded:!1,index:-1}}function x(t){return void 0===t||Object(h.t)(t.value)?0:t.value.length}function g(t,i){return!(Array.isArray(t)&&t[i.open]>0&&t[i.high]>0&&t[i.low]>0&&t[i.close]>0&&t[i.vol]>0&&t[i.money]>0)}function v(t){const i=[];if(!Array.isArray(t))return i;for(let e=0;e<t.length;e++)g(t[e],s.FIELD_DAY)||i.push(t[e]);return i}function p(t,i,e,o){const n=[];if(t.length<1)return n;let a,l=5;!Object(h.h)(t[t.length-1][s.FIELD_DAY5.time])===e&&(l=4);let r=0,c=0;for(a=t.length-1;a>=0;a--){if(c!==Object(h.h)(t[a][s.FIELD_DAY5.time])&&(c=Object(h.h)(t[a][s.FIELD_DAY5.time]),++r>l)){a++;break}n.splice(0,0,[t[a][s.FIELD_DAY5.time],t[a][s.FIELD_DAY5.close],t[a][s.FIELD_DAY5.vol]])}r=0,c=0;let d=0,f=0;const u=I(o);for(a=0;a<n.length;a++){c!==Object(h.h)(n[a][s.FIELD_DAY5.time])&&(c=Object(h.h)(n[a][s.FIELD_DAY5.time]),r++,d=0,f=0),d+=n[a][s.FIELD_DAY5.vol],f+=n[a][s.FIELD_DAY5.close]*n[a][s.FIELD_DAY5.vol]/i;let t=w(n[a][s.FIELD_DAY5.time],o);t+=(r-1)*u,n[a][s.FIELD_DAY5.idx]=t,n[a][s.FIELD_DAY5.allvol]=d,n[a][s.FIELD_DAY5.allmoney]=f}return n}function y(t,i){const e=o({fields:t,value:i},"coinunit");return{stktype:o({fields:t,value:i},"type"),volunit:o({fields:t,value:i},"volunit"),coinunit:e,decimal:o({fields:t,value:i},"decimal"),before:o({fields:t,value:i,coinunit:e},"before"),stophigh:o({fields:t,value:i,coinunit:e},"stophigh"),stoplow:o({fields:t,value:i,coinunit:e},"stoplow")}}function b(t){const i=[],e=[],o=s.FIELD_DAY;let n=!0;for(let s=0;s<t.length;s++){n?(e[o.open]=t[s][o.open],e[o.high]=t[s][o.high],e[o.low]=t[s][o.low],n=!1):(e[o.high]=e[o.high]>t[s][o.high]?e[o.high]:t[s][o.high],e[o.low]=e[o.low]<t[s][o.low]||0===t[s][o.low]?e[o.low]:t[s][o.low]),e[o.close]=t[s][o.close],e[o.vol]=t[s][o.vol],e[o.money]=t[s][o.money];const a=Object(h.k)(t[s][o.time]);(s>=t.length-1||5===a||Object(h.i)(t[s][o.time],t[s+1][o.time])+a>7)&&(e[o.time]=t[s][o.time],i.push(Object(h.a)(e)),n=!0)}return n||(e[o.time]=t[t.length-1][o.time],i.push(Object(h.a)(e))),i}function M(t){let i;const e=[],o=[],n=s.FIELD_DAY;let a=!0;for(let s=0;s<t.length;s++)a?(o[n.open]=t[s][n.open],o[n.high]=t[s][n.high],o[n.low]=t[s][n.low],i=Object(h.j)(t[s][n.time]),a=!1):(o[n.high]=o[n.high]>t[s][n.high]?o[n.high]:t[s][n.high],o[n.low]=o[n.low]<t[s][n.low]||0===t[s][n.low]?o[n.low]:t[s][n.low]),o[n.close]=t[s][n.close],o[n.vol]=t[s][n.vol],o[n.money]=t[s][n.money],(s>=t.length-1||Object(h.j)(t[s+1][n.time])!==i)&&(o[n.time]=t[s][n.time],e.push(Object(h.a)(o)),a=!0);return a||(o[n.time]=t[t.length-1][n.time],e.push(Object(h.a)(o))),e}function I(t){let i=0;for(let e=0;e<t.length;e++)i+=Object(h.m)(t[e].begin,t[e].end);return i}function w(t,i){const e=Object(h.l)(t);let s=0,o=-1;for(let t=0;t<i.length;t++){if(e>i[t].begin&&e<i[t].end){o=s+Object(h.m)(i[t].begin,e);break}if(e<=i[t].begin&&0===t)return 0;if(e<=i[t].begin&&e>Object(h.n)(i[t].begin,-5))return s;if(s+=Object(h.m)(i[t].begin,i[t].end),e>=i[t].end&&t===i.length-1)return s-1;if(e>=i[t].end&&e<Object(h.n)(i[t].end,5))return s-1}return o}function D(t,i,e){let s=t,o=0,n=0;for(let t=0;t<i.length;t++){if(s<(n=Object(h.m)(i[t].begin,i[t].end))){o=Object(h.n)(i[t].begin,s+1);const n=new Date(Math.floor(e/1e4),Math.floor(e%1e4/100)-1,e%100,Math.floor(o/100),o%100,0);return Math.floor(n/1e3)}s-=n}return 0}},function(t,i,e){"use strict";e.r(i),e.d(i,"STOCK_TYPE_INDEX",function(){return s}),e.d(i,"STOCK_TYPE_A",function(){return h}),e.d(i,"STOCK_TYPE_B",function(){return o}),e.d(i,"STOCK_TYPE_OTHER",function(){return n}),e.d(i,"STOCK_TRADETIME",function(){return a}),e.d(i,"FIELD_DAY",function(){return l}),e.d(i,"FIELD_MIN",function(){return r}),e.d(i,"FIELD_TICK",function(){return c}),e.d(i,"FIELD_DAY5",function(){return d}),e.d(i,"FIELD_LINE",function(){return f}),e.d(i,"FIELD_ILINE",function(){return u}),e.d(i,"FIELD_NOW",function(){return m}),e.d(i,"FIELD_ENOW",function(){return x}),e.d(i,"FIELD_NOW_IDX",function(){return g}),e.d(i,"FIELD_CODE",function(){return v}),e.d(i,"FIELD_INFO",function(){return p}),e.d(i,"FIELD_RIGHT",function(){return y}),e.d(i,"FIELD_FINANCE",function(){return b}),e.d(i,"FIELD_TRADE",function(){return M});const s=0,h=1,o=4,n=5,a=[{begin:930,end:1130},{begin:1300,end:1500}],l={time:0,open:1,high:2,low:3,close:4,vol:5,money:6},r={idx:0,open:1,high:2,low:3,close:4,vol:5,money:6,allvol:5,allmoney:6},c={time:0,close:1,vol:2},d={time:0,close:1,vol:2,idx:3,allvol:4,allmoney:5},f={time:0,value:1},u={idx:0,value:1},m={time:0,open:1,high:2,low:3,close:4,vol:5,money:6,buy1:7,buyvol1:8,sell1:9,sellvol1:10,buy2:11,buyvol2:12,sell2:13,sellvol2:14,buy3:15,buyvol3:16,sell3:17,sellvol3:18,buy4:19,buyvol4:20,sell4:21,sellvol4:22,buy5:23,buyvol5:24,sell5:25,sellvol5:26},x={time:0,open:1,high:2,low:3,close:4,vol:5,money:6,buy1:7,buyvol1:8,sell1:9,sellvol1:10},g={time:0,open:1,high:2,low:3,close:4,vol:5,money:6,ups:7,upvol:8,downs:9,downvol:10,mids:11,midvol:12},v={index:0,code:1,name:2,spell:3,type:4,decimal:5,volunit:6,before:7,stophigh:8,stoplow:9},p={name:0,type:1,decimal:2,volunit:3,before:4,stophigh:5,stoplow:6},y={time:0,sendstock:1,allotstock:2,allotprice:3,accrual:4},b={code:0,time:1,flow:2,total:3,earnings:4},M={time:0,code:1,type:2,price:3,vol:4,money:5,info:6}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return ClFormula});var _data_cl_data_tools__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);class ClFormula{constructor(){this.source={data:{},minIndex:0,maxIndex:0,nowIndex:0}}getValue(t,i){if(void 0===t)return 0;if(void 0===this.source.data||void 0===this.source.data.value)return 0;void 0===this.source.nowIndex&&(this.source.nowIndex=this.source.minIndex);const e=this.source.nowIndex-i;return Object(_data_cl_data_tools__WEBPACK_IMPORTED_MODULE_0__.d)(this.source.data,t,e)}runSingleStock(source,formula){if(!eval){const t=[],i=formula.match(/\.(\w+)(\(.+)/),e=i[1];if("function"!=typeof this[e])return t;let s=i[2]||"";for(s=s.replace(/\(|\)/g,"").split(","),this.source=source,this.source.nowIndex=this.source.minIndex;this.source.nowIndex<=this.source.maxIndex;this.source.nowIndex++){const i=this[e](...s);t.push([this.getValue("idx",0),i])}return t}const singleValue=[];this.source=source;const command=`\n    for (this.source.nowIndex = this.source.minIndex;this.source.nowIndex <= this.source.maxIndex;this.source.nowIndex++) {\n          const ${formula}\n          singleValue.push([this.getValue('idx', 0), out]);\n    }`;return eval(command),singleValue}MA(t,i){let e=0,s=0;for(let h=0;h<i;h++){const i=this.getValue(t,h);0!==i&&(e++,s+=i)}return 0===e?0:s/e}AVGPRC(){return this.getValue("allmoney",0)/this.getValue("allvol",0)}}},function(t,i,e){"use strict";e.r(i);var s={};e.d(s,"CHART_LAYOUT",function(){return B}),e.d(s,"CHART_BUTTONS",function(){return G}),e.d(s,"CHART_ORDER",function(){return q}),e.d(s,"CHART_KBAR",function(){return Z}),e.d(s,"CHART_VBAR",function(){return $}),e.d(s,"CHART_NOW",function(){return J}),e.d(s,"CHART_NOWVOL",function(){return Q}),e.d(s,"CHART_DAY5",function(){return tt}),e.d(s,"CHART_DAY5VOL",function(){return it}),e.d(s,"CHART_NORMAL",function(){return et});var h=e(0);function o(t,i){t.lineWidth=i}function n(t,i,e,s){t.moveTo(i,e),t.lineTo(i,s)}function a(t,i,e,s){t.moveTo(i,s),t.lineTo(e,s)}function l(t,i,e){t.moveTo(i,e)}function r(t,i,e){t.lineTo(i,e)}function c(t,i,e,s,h){t.strokeRect(i,e,s,h)}function d(t,i,e,s,h,o){t.fillStyle=o||t.fillStyle,t.fillRect(i,e,s,h)}function f(t,i){t.beginPath(),t.strokeStyle=i||t.strokeStyle}function u(t){t.stroke()}function m(t,i,e,s,h,o){o=void 0===o?5:o;const n=(a=s-i,l=h-e,Math.sqrt(Math.pow(a,2)+Math.pow(l,2)));var a,l;const r=Math.floor(n/o);for(let o=0;o<r;o++)t[o%2==0?"moveTo":"lineTo"](i+(s-i)/r*o,e+(h-e)/r*o)}function x(t,i,e){t.font=e+"px "+i}function g(t,i,e,s,h,o,n,a){x(t,h,o),t.fillStyle=n||t.fillStyle,t.textBaseline=a&&a.y||"top",t.textAlign=a&&a.x||"start",t.fillText(s.toString(),i,e)}function v(t,i,e){const s=e/12;let h=0;for(let e=0;e<i.length;e++){const s=i[e].toString();t&&t[s]?h+=t[s].width:h+=12}return h*s}function p(t,i,e,s){let h;if(x(t,e,s),t.measureText)try{h=t.measureText(i).width}catch(e){h=v(t.charMap,i,s)}else h=v(t.charMap,i,s);return h}function y(t,i,e){const s=e.spaceX||2,h=e.spaceY||2;return{width:p(t,i,e.font,e.pixel)+2*s,height:e.pixel+2*h}}function b(t,i,e,s,h){const o=h.spaceX||2,n=h.spaceY||2,a=y(t,s,h);let l,r;r=e,l=i,"middle"===h.y&&(r=e-Math.floor(a.height/2)),"end"===h.x&&(l=i-a.width),"center"===h.x&&(l=i-Math.floor(a.width/2)),d(t,l,r,a.width,a.height,h.bakclr),f(t,h.clr),c(t,l,r,a.width,a.height),l=i,r=e,"start"===h.x&&(l=i+o),"end"===h.x&&(l=i-o),"top"===h.y&&(r=e-n),g(t,l,r,s,h.font,h.pixel,h.clr,{x:h.x,y:h.y}),u(t)}function M(t,i,e,s){t.moveTo(i+s,e),t.arc(i,e,s,0,2*Math.PI,!0)}function I(t,i,e,s,h){t.moveTo(i+s,e),t.arc(i,e,s,0,2*Math.PI,!0),t.fillStyle=h,t.fill()}function w(t,i,e,s,h,o){const n=t.strokeStyle;f(t,o),t.moveTo(i,e),t.lineTo(s,h),u(t),t.strokeStyle=n}function D(t,i,e,s,h,o){void 0!==s&&s.r>0&&(f(t,s.clr),I(t,i,e,s.r,s.clr),u(t)),void 0!==h&&h.r>0&&(f(t,h.clr),I(t,i,e,h.r,h.clr),u(t)),void 0!==o&&o.r>0&&(f(t,o.clr),I(t,i,e,o.r,o.clr),u(t))}function k(t,i,e){f(t,i.clr),m(t,i.xx,i.yy,i.right-i.pixel/2,i.yy,7),u(t);const s=i.spaceX||2*i.linew,h=i.spaceY||i.linew;i.width=i.right-i.xx;for(let o=0;o<e.length;o++){if("false"===e[o].display)continue;let n=i.xx+i.width*e[o].set/100;if("arc"===e[o].txt)n+e[o].maxR>i.right&&(n=i.right-e[o].maxR),D(t,n,i.yy,{r:e[o].maxR,clr:i.clr},{r:e[o].minR,clr:i.bakclr});else{const a=y(t,e[o].txt,{font:i.font,pixel:i.pixel,spaceX:s,spaceY:h});n+a.width>i.right&&(n=i.right-a.width);let l=i.yy;i.top&&l<i.top+a.height/2&&(l=i.top+a.height/2),i.bottom&&l>i.bottom-a.height/2&&(l=i.bottom-a.height/2),b(t,n,l,e[o].txt,{font:i.font,pixel:i.pixel,clr:i.clr,bakclr:i.bakclr,x:"start",y:i.y,spaceX:s,spaceY:h})}}}function O(t,i,e){const s=i.rect.left+i.index*(i.unitX+i.spaceX),h=s+Math.floor(i.unitX/2),o=i.rect.top+Math.round((i.maxmin.max-e[1])*i.unitY),l=i.rect.top+i.rect.height-Math.round((e[2]-i.maxmin.min)*i.unitY);let r;const f=i.rect.top+Math.round((i.maxmin.max-e[0])*i.unitY);e[0]===e[3]?(r=0,a(t,s,s+i.unitX,f),e[1]>e[2]&&n(t,h,o,l)):(r=Math.round((e[0]-e[3])*i.unitY),n(t,h,o,f),i.filled?d(t,s,f,i.unitX,r,i.fillclr):c(t,s,f,i.unitX,r),n(t,h,f+r,l))}function C(t,i,e){const s=i.rect.left+i.index*(i.unitX+i.spaceX),h=i.rect.top+Math.round((i.maxmin.max-e)*i.unitY),o=i.rect.top+i.rect.height-h;i.filled?d(t,s,h,i.unitX,o,i.fillclr):c(t,s,h,i.unitX,o)}function T(t,i,e){let s=t.toLowerCase();if(s&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(s)){if(4===s.length){let t="#";for(let i=1;i<4;i+=1)t+=s.slice(i,i+1).concat(s.slice(i,i+1));s=t}const t=[];for(let i=1;i<7;i+=2)t.push(parseInt("0x"+s.slice(i,i+2)));switch(e){case"adjust":const i=t[0],s=t[1],h=t[2];t[0]=.272*i+.534*s+.131*h,t[1]=.349*i+.686*s+.168*h,t[2]=.393*i+.769*s+.189*h}return"rgba("+(s=t.join(","))+","+(i=i||1)+")"}return s}var X=e(1);function Y(t,i,e,s){if(void 0===e&&(e="time"),s&&"forword"===s){for(let s=t.value.length-1;s>=0;s--)if(!(Object(X.d)(t,e,s)>i))return s}else for(let s=0;s<=t.value.length-1;s++)if(!(Object(X.d)(t,e,s)<i))return s;return-1}function j(t,i){t.showMode="fixed",t.fixed={min:0,max:i.maxCount-1,left:0,right:0},t.minIndex=0,t.maxIndex=i.size-1,t.maxCount=i.maxCount>1?i.maxCount:2,t.unitX=i.scale,t.spaceX=i.width/t.maxCount-t.unitX}const E={sys:"white",line:["#4048cc","#dd8d2d","#168ee0","#ad7eac","#ff8290","#ba1215"],back:"#fafafa",txt:"#2f2f2f",baktxt:"#2f2f2f",axis:"#7f7f7f",grid:"#cccccc",red:"#ff6a6c",green:"#32cb47",white:"#7e7e7e",vol:"#dd8d2d",button:"#888888",colume:"#41bfd0",box:"#ddf4df",code:"#3f3f3f"},L={sys:"black",line:["#efefef","#fdc104","#5bbccf","#ad7eac","#bf2f2f","#cfcfcf"],back:"#232323",txt:"#bfbfbf",baktxt:"#2f2f2f",axis:"#afafaf",grid:"#373737",red:"#ff6a6c",green:"#6ad36d",white:"#9f9f9f",vol:"#fdc104",button:"#9d9d9d",colume:"#41bfd0",box:"#373737",code:"#41bfd0"},_={runPlatform:"normal",axisPlatform:"web",eventPlatform:"html5",scale:1,standard:"china",sysColor:"black",charMap:{0:{width:7.1999969482421875},1:{width:4.8119964599609375},2:{width:7.1999969482421875},3:{width:7.1999969482421875},4:{width:7.1999969482421875},5:{width:7.1999969482421875},6:{width:7.1999969482421875},7:{width:6.563995361328125},8:{width:7.1999969482421875},9:{width:7.1999969482421875},".":{width:3.167999267578125},",":{width:3.167999267578125},"%":{width:11.639999389648438},":":{width:3.167999267578125}," ":{width:3.9959869384765625},K:{width:8.279998779296875},V:{width:7.667999267578125},O:{width:9.203994750976562},L:{width:7.055999755859375},"-":{width:7.2599945068359375},"[":{width:3.9959869384765625},"]":{width:3.9959869384765625}},mainCanvas:{},cursorCanvas:{}};function S(t){let i={};if(i="white"===t?Object(h.b)(E):Object(h.b)(L),"usa"===_.standard){const t=i.red;i.red=i.green,i.green=t}return _.color=i,i}function P(t,i){return t.width=t.clientWidth*i,t.height=t.clientHeight*i,{width:t.width,height:t.height}}function A(t){if(void 0!==t){for(const i in _)_[i]=t[i]||_[i];return _.mainCanvas.canvas=t.mainCanvas.canvas,_.mainCanvas.context=t.mainCanvas.context,_.mainCanvas.context.charMap=_.charMap,_.cursorCanvas.canvas=t.cursorCanvas.canvas,_.cursorCanvas.context=t.cursorCanvas.context,_.cursorCanvas.context.charMap=_.charMap,_.color=S(_.sysColor),"normal"===_.runPlatform&&void 0!==_.mainCanvas.canvas&&1!==_.scale&&(P(_.mainCanvas.canvas,_.scale),P(_.cursorCanvas.canvas,_.scale)),_}}function F(t,i){t.father=i,t.context=i.context,t.scale=_.scale,t.color=_.color,t.axisPlatform=_.axisPlatform,t.eventPlatform=_.eventPlatform}function R(t){const i=_.scale;t.margin.top*=i,t.margin.left*=i,t.margin.bottom*=i,t.margin.right*=i,t.offset.top*=i,t.offset.left*=i,t.offset.bottom*=i,t.offset.right*=i,t.title.pixel*=i,t.title.height*=i,t.title.spaceX*=i,t.title.spaceY*=i,t.title.height<t.title.pixel+t.title.spaceY+2*i&&(t.title.height=t.title.pixel+t.title.spaceY+2*i),t.axisX.pixel*=i,t.axisX.width*=i,t.axisX.height*=i,t.axisX.spaceX*=i,t.scroll.pixel*=i,t.scroll.size*=i,t.scroll.spaceX*=i,t.digit.pixel*=i,t.digit.height*=i,t.digit.spaceX*=i,t.digit.height<t.digit.pixel+2*i&&(t.digit.height=t.digit.pixel+2*i),t.symbol.size*=i,t.symbol.spaceX*=i,t.symbol.spaceY*=i}function N(t){"html5"===_.eventPlatform&&(_.mainCanvas.canvas.style.cursor=t,_.cursorCanvas.canvas.style.cursor=t)}function H(t){return void 0===t&&(t=0),_.color.line[t%_.color.line.length]}class z{constructor(t,i){F(this,t),this.rectMain=i,this.linkInfo=t.father.linkInfo,this.source=t.father,this.maxmin=t.maxmin}onPaint(t){void 0!==t&&(this.hotKey=t),this.data=this.source.getData(this.hotKey),this.codeInfo=this.source.getData("INFO");let i,e,s=this.color.red;f(this.context,s);let h=Object(X.d)(this.codeInfo,"before",0);for(let t=0,o=this.linkInfo.minIndex;o<=this.linkInfo.maxIndex;t++,o++)o>0&&(h=Object(X.d)(this.data,"close",o-1)),((i=Object(X.d)(this.data,"open",o))<(e=Object(X.d)(this.data,"close",o))||i===e&&e>=h)&&O(this.context,{filled:"white"===this.color.sys,index:t,spaceX:this.linkInfo.spaceX,unitX:this.linkInfo.unitX,unitY:this.maxmin.unitY,maxmin:this.maxmin,rect:this.rectMain,fillclr:s},[e,Object(X.d)(this.data,"high",o),Object(X.d)(this.data,"low",o),i]);u(this.context),s=this.color.green,f(this.context,s);for(let t=0,o=this.linkInfo.minIndex;o<=this.linkInfo.maxIndex;t++,o++)o>0&&(h=Object(X.d)(this.data,"close",o-1)),((i=Object(X.d)(this.data,"open",o))>(e=Object(X.d)(this.data,"close",o))||i===e&&e<h)&&O(this.context,{filled:!0,index:t,spaceX:this.linkInfo.spaceX,unitX:this.linkInfo.unitX,unitY:this.maxmin.unitY,maxmin:this.maxmin,rect:this.rectMain,fillclr:s},[i,Object(X.d)(this.data,"high",o),Object(X.d)(this.data,"low",o),e]);u(this.context)}}class K{constructor(t,i){F(this,t),this.rectMain=i,this.linkInfo=t.father.linkInfo,this.source=t.father,this.maxmin=t.maxmin}onPaint(t){let i,e;void 0!==t&&(this.hotKey=t),this.data=this.source.getData(this.hotKey),void 0===this.info.labelX&&(this.info.labelX="idx"),void 0===this.info.labelY&&(this.info.labelY="value");let s,o,n=!1,a=0;o=void 0===this.info.color?H(this.info.colorIndex):this.color[this.info.color],f(this.context,o);for(let t=this.linkInfo.minIndex,o=0;t<=this.linkInfo.maxIndex;t++,o++)s=void 0===this.info.showSort?o:Object(X.d)(this.data,this.info.showSort,o),i=this.rectMain.left+s*(this.linkInfo.unitX+this.linkInfo.spaceX),e=this.rectMain.top+Math.round((this.maxmin.max-Object(X.d)(this.data,this.info.labelY,o))*this.maxmin.unitY),Math.floor(s/this.info.skips)>a&&(a=Math.floor(s/this.info.skips),n=!1),n?r(this.context,i,e):(n=Object(h.r)(this.rectMain,{x:i,y:e}))&&l(this.context,i,e);u(this.context)}}class V{constructor(t,i){F(this,t),this.rectMain=i,this.linkInfo=t.father.linkInfo,this.source=t.father,this.symbol=t.layout.symbol}onPaint(t){if(void 0!==t&&(this.hotKey=t),this.data=this.source.getData(this.hotKey),this.rightData=this.source.getData("RIGHT"),Object(X.k)(this.rightData)<1)return;const i=p(this.context,"▲",this.symbol.font,this.symbol.pixel);for(let t=0;t<this.rightData.value.length;t++){const e=Y(this.data,Object(X.d)(this.rightData,"time",t))-this.linkInfo.minIndex,s=this.rectMain.left+e*(this.linkInfo.unitX+this.linkInfo.spaceX)+Math.floor(this.linkInfo.unitX/2);if(s<this.rectMain.left)continue;let h=this.color.button;"no"!==this.linkInfo.rightMode&&(h=this.color.vol),g(this.context,s-Math.floor(i/2),this.rectMain.top+this.rectMain.height-this.symbol.pixel-this.symbol.spaceY,"▲",this.symbol.font,this.symbol.pixel,h,{y:"top"})}}}class W{constructor(t,i){F(this,t),this.rectMain=i,this.linkInfo=t.father.linkInfo,this.source=t.father,this.maxmin=t.maxmin}onPaint(t){let i,e,s,h,o;void 0!==t&&(this.hotKey=t),this.data=this.source.getData(this.hotKey),void 0===this.info.labelX&&(this.info.labelX="time"),void 0===this.info.labelY&&(this.info.labelY="vol"),o=void 0===this.info.color?H(this.info.colorIndex):this.color[this.info.color],f(this.context,o);for(let t=this.linkInfo.minIndex,o=0;t<=this.linkInfo.maxIndex;t++,o++)h=void 0===this.info.showSort?o:Object(X.d)(this.data,this.info.showSort,o),i=this.rectMain.left+Math.floor(h*(this.linkInfo.spaceX+this.linkInfo.unitX)),(s=Object(X.d)(this.data,this.info.labelY,t))<0||((e=this.rectMain.top+Math.round((this.maxmin.max-s)*this.maxmin.unitY))<this.rectMain.top?(e=this.rectMain.top+1,w(this.context,i,this.rectMain.top+this.rectMain.height-1,i,e,this.color.white)):(l(this.context,i,this.rectMain.top+this.rectMain.height-1),r(this.context,i,e)));u(this.context)}}const B={margin:{left:0,top:0,right:0,bottom:0},offset:{left:2,top:2,right:2,bottom:0},title:{pixel:12,height:18,spaceX:10,spaceY:2,font:"sans-serif"},axisX:{pixel:12,height:18,width:50,spaceX:2,font:"sans-serif"},scroll:{pixel:12,size:15,spaceX:10,font:"sans-serif"},digit:{pixel:12,height:16,spaceX:3,font:"sans-serif"},symbol:{pixel:10,size:18,spaceX:3,font:"sans-serif"}},G=[{key:"zoomin"},{key:"zoomout"},{key:"exright"}],q={style:"normal",title:{display:"text"}},U={index:3,list:[1,2,3,4,5,6,7,8,9,10,11]},Z={zoomInfo:U,scroll:{display:"none"},title:{display:"text",label:"K线"},axisX:{lines:0,display:"none",type:"normal",format:"date"},axisY:{lines:3,left:{display:"both",middle:"none",format:"price"},right:{display:"both",middle:"none",format:"price"}},lines:[{className:z,extremum:{method:"normal",maxvalue:["high"],minvalue:["low"]}},{className:V},{className:K,info:{txt:"5:",labelY:"value",format:"price"},formula:{key:"DAYM1",command:"out = this.MA('close',5)"}},{className:K,info:{txt:"10:",labelY:"value",format:"price"},formula:{key:"DAYM2",command:"out = this.MA('close',10)"}},{className:K,info:{txt:"20:",labelY:"value",format:"price"},formula:{key:"DAYM3",command:"out = this.MA('close',20)"}},{className:K,info:{txt:"60:",labelY:"value",format:"price"},formula:{key:"DAYM4",command:"out = this.MA('close',60)"}}]},$={zoomInfo:U,title:{display:"text",label:"VOL"},axisX:{lines:0,display:"both",type:"normal",format:"date"},axisY:{lines:1,left:{display:"nofoot",middle:"none",format:"vol"},right:{display:"nofoot",middle:"none",format:"vol"}},lines:[{className:class{constructor(t,i){F(this,t),this.rectMain=i,this.linkInfo=t.father.linkInfo,this.source=t.father,this.maxmin=t.maxmin}onPaint(t){void 0!==t&&(this.hotKey=t),this.data=this.source.getData(this.hotKey),f(this.context,this.color.red);for(let t=0,i=this.linkInfo.minIndex;i<=this.linkInfo.maxIndex;t++,i++)parseFloat(Object(X.d)(this.data,"open",i))<=parseFloat(Object(X.d)(this.data,"close",i))&&C(this.context,{filled:"white"===this.color.sys,index:t,spaceX:this.linkInfo.spaceX,unitX:this.linkInfo.unitX,unitY:this.maxmin.unitY,maxmin:this.maxmin,rect:this.rectMain,fillclr:this.color.red},Object(X.d)(this.data,"vol",i));u(this.context),f(this.context,this.color.green);for(let t=0,i=this.linkInfo.minIndex;i<=this.linkInfo.maxIndex;t++,i++)parseFloat(Object(X.d)(this.data,"open",i))>parseFloat(Object(X.d)(this.data,"close",i))&&C(this.context,{filled:!0,index:t,spaceX:this.linkInfo.spaceX,unitX:this.linkInfo.unitX,unitY:this.maxmin.unitY,maxmin:this.maxmin,rect:this.rectMain,fillclr:this.color.green},Object(X.d)(this.data,"vol",i));u(this.context)}},extremum:{method:"normal",maxvalue:["vol"],minvalue:[0]},info:{labelY:"vol",format:"vol"}},{className:K,info:{txt:"5:",labelY:"value",format:"vol"},formula:{key:"MVOL1",command:"out = this.MA('vol',5)"}},{className:K,info:{txt:"10:",labelY:"value",format:"vol"},formula:{key:"MVOL2",command:"out = this.MA('vol',10)"}},{className:K,info:{txt:"20:",labelY:"value",format:"vol"},formula:{key:"MVOL3",command:"out = this.MA('vol',20)"}}]},J={title:{display:"none"},axisX:{lines:3,display:"none",type:"day1",format:"tradetime"},axisY:{lines:3,left:{display:"both",middle:"before",format:"price"},right:{display:"both",middle:"before",format:"rate"}},lines:[{className:K,extremum:{method:"fixedLeft",maxvalue:["high"],minvalue:["low"]},info:{labelX:"idx",labelY:"close",showSort:"idx"}},{className:K,info:{showSort:"idx"},formula:{key:"NOWM1",command:"out = this.AVGPRC()"}}]},Q={title:{display:"none"},axisX:{lines:3,display:"both",type:"day1",format:"tradetime"},axisY:{lines:1,left:{display:"nofoot",middle:"none",format:"vol"},right:{display:"nofoot",middle:"none",format:"vol"}},lines:[{className:W,extremum:{method:"normal",maxvalue:["decvol"],minvalue:[0]},info:{showSort:"idx",labelX:"idx",labelY:"decvol",color:"vol"}}]},tt={title:{display:"none"},axisX:{lines:4,display:"none",type:"day5",format:"date"},axisY:{lines:3,left:{display:"both",middle:"before",format:"price"},right:{display:"both",middle:"before",format:"rate"}},lines:[{className:K,extremum:{method:"fixedLeft",maxvalue:["close"],minvalue:["close"]},info:{showSort:"idx",labelX:"time",labelY:"close"}},{className:K,info:{showSort:"idx"},formula:{key:"NOWDAY5",command:"out = this.AVGPRC()"}}]},it={title:{display:"none"},axisX:{lines:4,display:"block",type:"day5",format:"date"},axisY:{lines:1,left:{display:"nofoot",middle:"none",format:"vol"},right:{display:"nofoot",middle:"none",format:"vol"}},lines:[{className:W,extremum:{method:"normal",maxvalue:["vol"],minvalue:[0]},info:{showSort:"idx",labelX:"time",labelY:"vol",color:"vol"}}]},et={title:{display:"text",label:"NORMAL"},axisX:{lines:0,display:"none",type:"normal",format:"date"},axisY:{lines:1,left:{display:"both",middle:"none",format:"price"},right:{display:"both",middle:"none",format:"price"}},lines:[{className:K}]};var st=e(2);const ht={shape:"arc",hotIdx:0,visible:!0,translucent:!0,status:"enabled"};class ot{constructor(t){F(this,t)}init(t,i){this.callback=i,this.rectMain=t.rectMain||{left:0,top:0,width:25,height:25},this.layout=Object(h.v)(t.layout,B),this.config=Object(h.v)(t.config,ht),this.info=t.info||[{map:"+"}],this.checkConfig()}checkConfig(){R(this.layout)}setStatus(t){this.config.status!==t&&(this.config.status=t)}onClick(t){this.config.visible&&(this.info.length>1&&(this.config.hotIdx++,this.config.hotIdx%=this.info.length,this.onPaint()),this.config.hotIdx>=0&&this.config.hotIdx<this.info.length?this.callback({self:this,info:this.info[this.config.hotIdx]}):this.callback({self:this}),t.break=!0)}onPaint(){if(!this.config.visible)return;o(this.context,this.scale);let t=this.color.button;"disabled"===this.config.status&&(t=this.color.grid),f(this.context,t);const i={xx:Math.floor(this.rectMain.width/2),yy:Math.floor(this.rectMain.height/2),offset:4*this.scale},e=this.info[this.config.hotIdx];switch(this.config.shape){case"set":"focused"===this.config.status?(t=this.color.red,this.config.translucent&&(t=T(t,.95)),s=this.context,h=this.rectMain.left+i.xx,m=this.rectMain.top+i.xx,void 0!==(x={r:Math.round(this.layout.symbol.size/2),clr:t})&&x.r>0&&(f(s,x.clr),l(s,h-x.r,m),r(s,h+x.r,m),r(s,h,m+2*x.r),r(s,h-x.r,m),function(t,i){t.fillStyle=i,t.fill()}(s,x.clr),I(s,h,m,x.r,x.clr),u(s)),i.yy=i.xx):(t=this.color.vol,this.config.translucent&&(t=T(t,.85)),D(this.context,this.rectMain.left+i.xx,this.rectMain.top+i.xx,{r:Math.round(this.layout.symbol.size/2),clr:t}));break;case"arc":M(this.context,this.rectMain.left+i.xx,this.rectMain.top+i.xx,i.xx);break;case"box":d(this.context,this.rectMain.left,this.rectMain.top,this.rectMain.width,this.rectMain.height,this.color.back),c(this.context,this.rectMain.left,this.rectMain.top,this.rectMain.width,this.rectMain.height);break;case"range":case"radio":case"checkbox":M(this.context,this.rectMain.left+i.xx,this.rectMain.top+i.xx,i.xx)}var s,h,m,x;switch(u(this.context),"disabled"===this.config.status?f(this.context,this.color.grid):f(this.context,this.color.button),e.map){case"+":n(this.context,this.rectMain.left+i.xx,this.rectMain.top+i.offset,this.rectMain.top+this.rectMain.height-i.offset),a(this.context,this.rectMain.left+i.offset,this.rectMain.left+this.rectMain.width-i.offset,this.rectMain.top+i.yy);break;case"-":a(this.context,this.rectMain.left+i.offset,this.rectMain.left+this.rectMain.width-i.offset,this.rectMain.top+i.yy);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":g(this.context,this.rectMain.left+i.xx,this.rectMain.top+i.yy,e.map,this.layout.title.font,this.layout.title.pixel,this.color.baktxt,{x:"center",y:"middle"});break;case"*":g(this.context,this.rectMain.left+i.xx,this.rectMain.top+i.yy-2*this.scale,"...",this.layout.title.font,this.layout.title.pixel,this.color.baktxt,{x:"center",y:"middle"});break;case"left":case"right":break;default:g(this.context,this.rectMain.left+i.xx,this.rectMain.top+i.yy,e.map,this.layout.title.font,this.layout.title.pixel,this.color.button,{x:"center",y:"middle"})}u(this.context)}}const nt={shape:"fixed",direct:"horizontal",range:100,select:{min:40,max:60},status:"enabled",txt:{}};class at{constructor(t){F(this,t)}init(t,i){this.callback=i,this.rectMain=t.rectMain||{left:0,top:0,width:200,height:25},this.layout=Object(h.v)(t.layout,B),this.config=Object(h.v)(t.config,nt),this.checkConfig(),this.setPublicRect()}checkConfig(){R(this.layout)}setPublicRect(){const t=this.config.range;let i,e,s,o;this.rectChart=Object(h.u)(this.rectMain,this.layout.margin),"horizontal"===this.config.direct&&(i=this.rectMain.width/(t-1),o=this.rectMain.height-2*this.scale,e=this.rectMain.left+i*this.config.select.min,s=this.rectMain.left+i*this.config.select.max,"free"===this.config.shape?(this.rectMin={left:e-this.layout.scroll.size/2,top:this.rectMain.top+this.scale,width:this.layout.scroll.size,height:o},this.rectMax={left:s-this.layout.scroll.size/2,top:this.rectMain.top+this.scale,width:this.layout.scroll.size,height:o},this.rectMid={left:e+this.layout.scroll.size/2,top:this.rectMain.top+this.scale,width:s-e-this.layout.scroll.size,height:o}):this.rectMid={left:e,top:this.rectMain.top+this.scale,width:s-e,height:o})}onPaint(){o(this.context,this.scale),this.drawClear(),this.drawGridline(),this.setPublicRect(),this.drawButton()}onChange(t){this.config=Object(h.v)(t,this.config),this.config.select.max>this.config.range&&(this.config.select.max=this.config.range-1),t.iscall&&this.callback({self:this,minIndex:this.config.select.min})}findMouseIndex(t){const i=this.config.range,e=this.rectMain.width/(i-1);return Math.round((t-this.rectMain.left)/e)}checkMin(t){return t<0?0:t>this.config.range-(this.config.select.max-this.config.select.min+1)?this.config.range-(this.config.select.max-this.config.select.min+1):t}onInit(){N("default"),this.who=void 0}onMouseOut(){N("default"),this.who=void 0}onMouseDown(t){const i=t.mousePos;Object(h.r)(this.rectMin,i)?this.who="min":Object(h.r)(this.rectMax,i)?this.who="max":Object(h.r)(this.rectMid,i)?(this.who="mid",this.index=this.findMouseIndex(i.x)):this.who=void 0}onMouseUp(t){if("free"!==this.config.shape&&void 0===this.who){const i=t.mousePos;let e=this.findMouseIndex(i.x)-Math.floor((this.config.select.max-this.config.select.min)/2);e=this.checkMin(e),this.onChange({min:e,iscall:!0})}this.who=void 0}onMouseMove(t){const i=t.mousePos;if(Object(h.r)(this.rectMin,i)||Object(h.r)(this.rectMax,i)?N("col-resize"):Object(h.r)(this.rectMid,i)?N("move"):N("default"),void 0!==this.who){let t,e;const s=this.findMouseIndex(i.x);"free"===this.config.shape?(s<this.config.select.max?"max"===this.who?e=s:"min"===this.who&&(t=s):s>=this.config.select.max&&("min"===this.who?(t=this.config.select.max,e=s,this.who="max"):"max"===this.who&&(e=s)),this.onChange({min:t,max:e,iscall:!0})):(t=this.config.select.min+s-this.index,this.index=s,t=this.checkMin(t),this.onChange({min:t,iscall:!0}))}}drawClear(){d(this.context,this.rectMain.left,this.rectMain.top,this.rectMain.width,this.rectMain.height,this.color.back)}drawGridline(){f(this.context,this.color.grid),c(this.context,this.rectMain.left,this.rectMain.top,this.rectMain.width+this.scale/2,this.rectMain.height),u(this.context)}drawButton(){if("horizontal"===this.config.direct){const t=(this.rectChart.height-this.layout.scroll.height)/2;void 0!==this.config.txt.head&&g(this.context,this.rectChart.left+this.scale,this.rectChart.top+t,this.config.txt.head,this.layout.scroll.font,this.layout.scroll.pixel,this.color.axis),void 0!==this.config.txt.tail&&g(this.context,this.rectChart.left+this.rectChart.width-this.scale,this.rectChart.top+t,this.config.txt.tail,this.layout.scroll.font,this.layout.scroll.pixel,this.color.axis,{x:"end"}),f(this.context,this.color.colume),c(this.context,this.rectMid.left,this.rectMid.top,this.rectMid.width,this.rectMid.height),d(this.context,this.rectMid.left,this.rectMid.top,this.rectMid.width,this.rectMid.height,this.color.box),"free"===this.config.shape&&(d(this.context,this.rectMin.left,this.rectMin.top,this.rectMin.width,this.rectMin.height,this.color.colume),d(this.context,this.rectMax.left,this.rectMax.top,this.rectMax.width,this.rectMax.height,this.color.colume)),u(this.context);const i=p(this.context,this.config.txt.left,this.layout.scroll.font,this.layout.scroll.pixel)+2*this.scale;void 0!==this.config.txt.left&&this.rectMid.width>i&&g(this.context,this.rectMid.left+this.scale,this.rectMid.top+t,this.config.txt.left,this.layout.scroll.font,this.layout.scroll.pixel,this.color.axis),void 0!==this.config.txt.right&&this.rectMid.width>2*i&&g(this.context,this.rectMid.left+this.rectMid.width-this.scale,this.rectMid.top+t,this.config.txt.right,this.layout.scroll.font,this.layout.scroll.pixel,this.color.axis,{x:"end"})}}}class lt{constructor(t,i){F(this,t),this.rectMain=i,this.linkInfo=t.father.linkInfo,this.axisX=t.config.axisX,this.maxmin=t.maxmin,this.text=t.layout.axisX}onPaint(){if(this.data=this.father.data,"none"===this.axisX.display)return;let t,i,e;t=this.rectMain.left+this.text.spaceX;const s=this.rectMain.top+this.rectMain.height/2;if("block"===this.axisX.display){let o=-1,n=0;const a=this.linkInfo.maxCount/(this.axisX.lines+1);e=this.rectMain.width/(this.axisX.lines+1);for(let l=this.linkInfo.minIndex;l<=this.linkInfo.maxIndex;l++){const r=Object(X.d)(this.data,"idx",l);r<0||(n=Math.floor(r/a))>o&&(o=n,t=this.rectMain.left+e/2+e*o,i=Object(h.h)(Object(X.d)(this.data,"time",l)),g(this.context,t,s,i,this.text.font,this.text.pixel,this.color.axis,{y:"middle",x:"center"}))}}else"tradetime"===this.axisX.format?(this.tradeTime=this.father.father.dataLayer.tradeTime,i=Object(h.e)(this.data.key,0,this.tradeTime[0].begin),g(this.context,t,s,i,this.text.font,this.text.pixel,this.color.axis,{y:"middle"}),t=this.rectMain.left+this.rectMain.width-3,i=Object(h.e)(this.data.key,0,this.tradeTime[this.tradeTime.length-1].end),g(this.context,t,s,i,this.text.font,this.text.pixel,this.color.axis,{y:"middle",x:"end"})):(i=Object(X.d)(this.data,"time",this.linkInfo.minIndex),i=Object(h.e)(this.data.key,i,this.maxmin.min),g(this.context,t,s,i,this.text.font,this.text.pixel,this.color.axis,{y:"middle"}),t=this.rectMain.left+this.rectMain.width-3,i=Object(X.d)(this.data,"time",this.linkInfo.maxIndex),i=Object(h.e)(this.data.key,i,this.maxmin.max),g(this.context,t,s,i,this.text.font,this.text.pixel,this.color.axis,{y:"middle",x:"end"}))}}class rt{constructor(t,i,e){F(this,t),this.rectMain=i,this.linkInfo=t.father.linkInfo,this.static=t.static,this.align=e,this.axisY=t.config.axisY,this.maxmin=t.maxmin,this.text=t.layout.title}onPaint(){if("none"===this.axisY[this.align].display)return;if(this.linkInfo.hideInfo)return;let t,i,e,s,o;const n="phone"===this.axisPlatform?2*this.scale:-2*this.scale;"left"===this.align?"phone"===this.axisPlatform?(o="start",t=this.rectMain.left+n):(o="end",t=this.rectMain.left+this.rectMain.width+n):"phone"===this.axisPlatform?(o="end",t=this.rectMain.left+this.rectMain.width-n):(o="start",t=this.rectMain.left-n),i=this.rectMain.top+this.scale,"noupper"!==this.axisY[this.align].display&&(i=this.rectMain.top+this.scale,s="before"!==this.axisY[this.align].middle?this.color.axis:this.color.red,e=Object(h.c)(this.maxmin.max,this.axisY[this.align].format,this.static.decimal,this.static.before),g(this.context,t,i,e,this.text.font,this.text.pixel,s,{x:o,y:"top"})),"nofoot"!==this.axisY[this.align].display&&(s="before"!==this.axisY[this.align].middle?this.color.axis:this.color.green,i=this.rectMain.top+this.rectMain.height-this.scale,e=Object(h.c)(this.maxmin.min,this.axisY[this.align].format,this.static.decimal,this.static.before),g(this.context,t,i,e,this.text.font,this.text.pixel,s,{x:o,y:"bottom"}));const a=this.rectMain.height/(this.axisY.lines+1);for(let n=0;n<this.axisY.lines;n++)e=this.maxmin.max-a*(n+1)/this.maxmin.unitY,i=this.rectMain.top+Math.round((n+1)*a),s=this.color.axis,"none"!==this.axisY[this.align].middle&&(n+1<Math.round(this.axisY.lines/2)&&(s=this.color.red),n+1>Math.round(this.axisY.lines/2)&&(s=this.color.green),n+1===Math.round(this.axisY.lines/2)&&(e="zero"===this.axisY[this.align].middle?0:this.static.before)),e=Object(h.c)(e,this.axisY[this.align].format,this.static.decimal,this.static.before),g(this.context,t,i,e,this.text.font,this.text.pixel,s,{x:o,y:"middle"})}}class ct{constructor(t,i,e){F(this,t),this.rectFather=t.rectMain,this.rectMain=i,this.rectChart=e,this.linkInfo=t.father.linkInfo,this.static=t.static,this.axisXInfo=t.config.axisX,this.axisYInfo=t.config.axisY,this.maxmin=t.maxmin,this.axisX=t.layout.axisX,this.context=t.father.cursorCanvas.context}onClear(){var t,i,e,s,h;t=this.context,i=this.rectFather.left,e=this.rectFather.top,s=this.rectFather.left+this.rectFather.width,h=this.rectFather.top+this.rectFather.height,t.clearRect(i,e,s,h)}onPaint(t,i,e){if("function"==typeof this.context._beforePaint&&this.context._beforePaint(),!1===Object(h.p)(this.rectChart,t.x))return;let s;this.onClear();let o=t.x,n=t.y;const a="phone"===this.axisPlatform?2*this.scale:-2*this.scale;if(Object(h.q)(this.rectChart,t.y)){void 0===e?e=this.maxmin.max-(t.y-this.rectChart.top)/this.maxmin.unitY:n=(this.maxmin.max-e)*this.maxmin.unitY+this.rectChart.top,w(this.context,this.rectMain.left,n,this.rectMain.left+this.rectMain.width,n,this.color.grid);let i="phone"===this.axisPlatform?"start":"end";"none"!==this.axisYInfo.left.display&&(s=Object(h.c)(e,this.axisYInfo.left.format,this.static.decimal,this.static.before),o=this.rectMain.left+a,b(this.context,o,n,s,{font:this.axisX.font,pixel:this.axisX.pixel,spaceX:this.axisX.spaceX,clr:this.color.txt,bakclr:this.color.grid,x:i,y:"middle"})),"none"!==this.axisYInfo.right.display&&(s=Object(h.c)(e,this.axisYInfo.right.format,this.static.decimal,this.static.before),i="phone"===this.axisPlatform?"end":"start",o=this.rectMain.left+this.rectMain.width-a,b(this.context,o,n,s,{font:this.axisX.font,pixel:this.axisX.pixel,spaceX:this.axisX.spaceX,clr:this.color.txt,bakclr:this.color.grid,x:i,y:"middle"}))}if(w(this.context,t.x,this.rectMain.top,t.x,this.rectMain.top+this.rectMain.height-1,this.color.grid),"none"!==this.axisXInfo.display){o=t.x;const e=Math.floor((this.axisX.height-this.axisX.pixel-this.scale)/2);n=this.rectMain.top+this.rectMain.height+e,s=Object(h.e)(this.father.data.key,i);const l=Math.round(p(this.context,s,this.axisX.font,this.axisX.pixel)/2);let r="center";o-l<this.rectMain.left+a&&(o=this.rectMain.left+a,r="start"),o+l>this.rectMain.left+this.rectMain.width-a&&(o=this.rectMain.left+this.rectMain.width-a,r="end"),b(this.context,o,n,s,{font:this.axisX.font,pixel:this.axisX.pixel,spaceX:this.axisX.spaceX,clr:this.color.txt,bakclr:this.color.grid,x:r,y:"top"})}"function"==typeof this.context._afterPaint&&this.context._afterPaint()}}class dt{constructor(t,i){F(this,t),this.rectMain=i,this.axisX=t.config.axisX,this.axisY=t.config.axisY}onPaint(){if(f(this.context,this.color.grid),a(this.context,this.rectMain.left,this.rectMain.left+this.rectMain.width,this.rectMain.top),this.axisY.lines>0){const t=this.rectMain.height/(this.axisY.lines+1);for(let i=0;i<this.axisY.lines;i++)a(this.context,this.rectMain.left,this.rectMain.left+this.rectMain.width,this.rectMain.top+Math.round((i+1)*t))}if("none"!==this.axisX.display&&a(this.context,this.rectMain.left,this.rectMain.left+this.rectMain.width,this.rectMain.top+this.rectMain.height),this.axisX.lines>0){const t=this.rectMain.width/(this.axisX.lines+1);for(let i=0;i<this.axisX.lines;i++)n(this.context,this.rectMain.left+Math.round((i+1)*t),this.rectMain.top,this.rectMain.top+this.rectMain.height)}"phone"!==this.axisPlatform&&(n(this.context,this.rectMain.left,this.rectMain.top,this.rectMain.top+this.rectMain.height),n(this.context,this.rectMain.left+this.rectMain.width,this.rectMain.top,this.rectMain.top+this.rectMain.height)),u(this.context)}}class ft{constructor(t,i,e){F(this,t),this.rectMain=i,this.rectMess=e,this.linkInfo=t.father.linkInfo,this.title=t.layout.title,this.titleInfo=t.config.title}onPaint(t){if("none"===this.titleInfo.display||this.linkInfo.hideInfo)return;d(this.context,this.rectMain.left+this.scale,this.rectMain.top+this.scale,this.rectMess.left+this.rectMess.width-2*this.scale,this.rectMain.height-2*this.scale,this.color.back);let i=this.color.txt;const e=Math.round((this.title.height-this.title.pixel)/2)-this.scale,s=this.rectMess.top+e;void 0!==this.titleInfo.label&&g(this.context,this.rectMain.left+this.scale,s,this.titleInfo.label,this.title.font,this.title.pixel,i);let h=this.rectMess.left+this.scale;for(let e=0;e<t.length;e++)i=this.color.line[e],void 0!==t[e].txt&&(g(this.context,h,s,t[e].txt,this.title.font,this.title.pixel,i),h+=p(this.context,t[e].txt,this.title.font,this.title.pixel)+this.title.spaceX),void 0!==t[e].value&&(g(this.context,h,s," "+t[e].value,this.title.font,this.title.pixel,i),h+=p(this.context," "+t[e].value,this.title.font,this.title.pixel)+this.title.spaceX)}}class ut{constructor(t){F(this,t),this.linkInfo=t.linkInfo,this.static=this.father.dataLayer.static,this.data={},this.maxmin={}}init(t,i){this.callback=i,this.rectMain=t.rectMain||{left:0,top:0,width:400,height:200},this.layout=Object(h.v)(t.layout,B),this.config=Object(h.b)(t.config),this.buttons=t.buttons||[],this.scroll=t.config.scroll||{display:"none"},this.childCharts={},this.checkConfig(),this.setPublicRect(),this.childDraws={},this.setChildDraw(),this.childLines={},this.setChildLines(),this.setButtons(),this.setScroll()}checkConfig(){R(this.layout),void 0!==this.config.zoomInfo&&this.setZoomInfo()}setPublicRect(){this.rectChart=Object(h.u)(this.rectMain,this.layout.margin);const t={width:this.layout.axisX.width};this.rectTitle={left:this.rectMain.left,top:this.rectMain.top,width:0,height:0},this.rectMess={left:this.rectMain.left,top:this.rectMain.top,width:0,height:0},"none"!==this.config.title.display&&(this.rectTitle={left:this.rectChart.left,top:this.rectChart.top,width:t.width,height:this.layout.title.height},this.rectMess={left:this.rectChart.left+t.width+this.scale,top:this.rectChart.top,width:this.rectChart.width-2*t.width,height:this.layout.title.height}),t.left=this.rectChart.left,t.right=this.rectChart.left+this.rectChart.width,t.top=this.rectTitle.top+this.rectTitle.height,t.bottom=this.rectChart.top+this.rectChart.height,"phone"!==this.axisPlatform&&("none"!==this.config.axisY.left.display&&(t.left+=this.layout.axisX.width),"none"!==this.config.axisY.right.display&&(t.right-=this.layout.axisX.width)),"none"!==this.config.axisX.display&&(t.bottom-=this.layout.axisX.height),"none"!==this.scroll.display&&(t.bottom-=this.layout.scroll.size),this.rectGridLine={left:t.left,top:t.top,width:t.right-t.left,height:t.bottom-t.top},this.rectAxisYLeft={left:this.rectChart.left,top:t.top,width:t.width,height:t.bottom-t.top},this.rectAxisYRight={left:this.rectChart.left+this.rectChart.width-t.width,top:t.top,width:t.width,height:t.bottom-t.top},this.rectChart=Object(h.u)(this.rectGridLine,this.layout.offset),this.rectAxisX={left:0,top:t.bottom,width:0,height:0},"none"!==this.config.axisX.display&&(this.rectAxisX={left:t.left,top:t.bottom+this.scale,width:t.right-t.left,height:this.layout.axisX.height}),"none"!==this.scroll.display&&(this.rectScroll={left:t.left,top:this.rectAxisX.top+this.rectAxisX.height+this.scale,width:t.right-t.left,height:this.layout.scroll.size})}getLineDataKey(t){return void 0===t.formula?this.hotKey:t.formula.key}setChildLines(){let t,i=0;for(let e=0;e<this.config.lines.length;e++){const s=this.config.lines[e].className;t=new s(this,this.rectChart),this.childLines["NAME"+e]=t,t.name="NAME"+e,t.hotKey=this.getLineDataKey(this.config.lines[e]),Object(h.o)(s,[K,W])&&(t.info={labelX:"idx",labelY:"value"},void 0!==this.config.lines[e].info&&(t.info=this.config.lines[e].info),"day5"===this.config.axisX.type&&(t.info.skips=Object(X.j)(this.father.dataLayer.tradeTime)),t.info.colorIndex=i,i++)}}setChildDraw(){let t;t=new ct(this,this.rectGridLine,this.rectChart),this.childDraws.CURSOR=t,"none"!==this.config.title.display&&(t=new ft(this,this.rectTitle,this.rectMess),this.childDraws.TITLE=t),"none"!==this.config.axisY.left.display&&(t=new rt(this,this.rectAxisYLeft,"left"),this.childDraws.AXISY_LEFT=t),"none"!==this.config.axisY.right.display&&(t=new rt(this,this.rectAxisYRight,"right"),this.childDraws.AXISY_RIGHT=t),"none"!==this.config.axisX.display&&(t=new lt(this,this.rectAxisX),this.childDraws.AXISX=t),t=new dt(this,this.rectGridLine),this.childDraws.GRID=t}setScroll(){if("none"===this.scroll.display)return;const t=new at(this);t.name="HSCROLL",this.childCharts[t.name]=t,t.init({rectMain:this.rectScroll,config:{width:8}},t=>{const i=t.self.father;i.father.linkInfo.minIndex!==t.minIndex&&(i.father.linkInfo.minIndex=t.minIndex,i.father.onPaint())})}createButton(t){if(void 0!==this.childCharts[t])return this.childCharts[t];const i=new ot(this);return i.name=t,this.childCharts[t]=i,i}hasButton(t,i){for(let e=0;e<i.length;e++)if(t===i[e].key)return!0;return!1}setButtons(){let t,i,e,s=25*this.scale;(this.hasButton("zoomin",this.buttons)||this.hasButton("zoomout",this.buttons))&&(t=this.createButton("zoomin"),i=Math.floor((this.rectChart.width-2*(s+s))/4),e=this.rectChart.top+.95*this.rectChart.height-s,t.init({rectMain:{left:i,top:e,width:s,height:s},info:[{map:"-"}]},()=>{this.config.zoomInfo.index>0&&(this.config.zoomInfo.index--,this.setZoomInfo(),this.father.onPaint())}),i+=2*s,(t=this.createButton("zoomout")).init({rectMain:{left:i,top:e,width:s,height:s},info:[{map:"+"}]},()=>{this.config.zoomInfo.index<this.config.zoomInfo.list.length-1&&(this.config.zoomInfo.index++,this.setZoomInfo(),this.father.onPaint())})),this.hasButton("exright",this.buttons)&&(t=this.createButton("exright"),s=p(this.context,"前复权",this.layout.title.font,this.layout.title.pixel),i=this.rectMain.left+this.rectMain.width-s-this.layout.title.spaceX,e="none"!==this.config.title.display?(this.rectMess.height-this.layout.title.pixel-2*this.layout.title.spaceY)/2:this.rectMain.top+this.layout.title.spaceY,t.init({rectMain:{left:i,top:this.rectMess.top+e,width:s+this.layout.title.spaceX,height:this.layout.title.pixel+2*this.layout.title.spaceY},config:{shape:"box"},info:[{map:"不除权",value:"no"},{map:"前复权",value:"forword"}]},t=>{this.father.linkInfo.rightMode=t.info.value,this.father.fastDrawEnd(),this.father.onPaint()}),t.hotIdx=0)}getDecimal(t){return"vol"===t||"decvol"===t?0:this.static.decimal}addLine(t){this.config.lines.push(t)}removeLine(t){for(let i=0;i<this.config.lines.length;i++)void 0!==this.config.lines[i].name&&this.config.lines[i].name===t&&this.config.lines.splice(i,1)}setZoomInfo(){const t=this.config.zoomInfo;t.index=t.index>t.list.length-1?t.list.length-1:t.index,t.index=t.index<0?0:t.index;const i=t.list[t.index];this.linkInfo.unitX=i*this.scale,this.linkInfo.unitX<this.scale&&(this.linkInfo.unitX=this.scale),this.linkInfo.spaceX=this.linkInfo.unitX/4,this.linkInfo.spaceX<this.scale&&(this.linkInfo.spaceX=this.scale),this.childCharts.zoomin&&(0===t.index?this.childCharts.zoomin.setStatus("disabled"):this.childCharts.zoomin.setStatus("enabled")),this.childCharts.zoomout&&(t.index===t.list.length-1?this.childCharts.zoomout.setStatus("disabled"):this.childCharts.zoomout.setStatus("enabled")),this.father.fastDrawEnd()}setHotButton(t){for(const i in this.childCharts)this.childCharts[i]===t?this.childCharts[i].focused=!0:this.childCharts[i].focused=!1}drawClear(){d(this.context,this.rectMain.left,this.rectMain.top,this.rectMain.width,this.rectMain.height,this.color.back),f(this.context,this.color.grid),c(this.context,this.rectMain.left,this.rectMain.top,this.rectMain.width,this.rectMain.height),u(this.context)}drawChildCharts(){let t;for(const i in this.childCharts)this.childCharts[i].focused?t=this.childCharts[i]:this.childCharts[i].onPaint();t&&t.onPaint()}beforeLocation(){for(const t in this.childLines)this.childLines[t].beforeLocation&&this.childLines[t].beforeLocation()}drawChildLines(){for(const t in this.childLines)void 0!==this.childLines[t].hotKey?this.childLines[t].onPaint(this.childLines[t].hotKey):this.childLines[t].onPaint(this.hotKey)}getMoveData(t){let i=this.config.lines;const e=[];if(!Array.isArray(i))return e;let s,o;for(let n=0;n<i.length;n++)void 0!==i[n].info&&(void 0!==i[n].info.labelY?(s=void 0===i[n].formula?Object(X.d)(this.data,i[n].info.labelY,t):Object(X.d)(this.father.getData(i[n].formula.key),i[n].info.labelY,t-this.linkInfo.minIndex),o=Object(h.c)(s,i[n].info.format,this.static.decimal),e.push({index:n,txt:i[n].info.txt,value:o})):e.push({index:n,txt:i[n].info.txt}));return e}drawTitleInfo(t){"none"!==this.config.title.display&&((void 0===t||t<0||t>this.linkInfo.maxIndex)&&(t=this.linkInfo.maxIndex),this.childDraws.TITLE.onPaint(this.getMoveData(t)))}drawChildDraw(t){void 0!==this.childDraws[t]&&("TITLE"===t?this.drawTitleInfo(this.linkInfo.moveIndex):this.childDraws[t].onPaint())}onPaint(){this.beforeLocation(),this.data=this.father.getData(this.hotKey),this.locationData(),this.father.readyData(this.data,this.config.lines),o(this.context,this.scale),this.drawClear(),this.drawChildDraw("GRID"),this.readyDraw(),this.drawChildDraw("AXISX"),this.drawChildDraw("AXISY_LEFT"),this.drawChildDraw("AXISY_RIGHT"),this.drawChildLines(),this.drawChildDraw("TITLE"),this.drawChildCharts()}getMiddle(t){let i=this.config.axisY.left.middle;return"fixedRight"===t&&(i=this.config.axisY.right.middle),"before"===i?this.static.before:0}calcMaxMin(t,i,e,s){const o={max:0,min:0};if("fixedLeft"===i.method||"fixedRight"===i.method){const t=this.getMiddle(i.method);o.min=.99*t,o.max=1.01*t}if(void 0===t||Object(h.t)(t.value))return o;let n;void 0===e&&(e=0),void 0===s&&(s=t.value.length-1);for(let a=e;a<=s;a++){if(!Object(h.t)(i.maxvalue))for(let e=0;e<i.maxvalue.length;e++)"string"==typeof i.maxvalue[e]&&(n=Object(X.d)(t,i.maxvalue[e],a))>0&&n>o.max&&(o.max=n);if(!Object(h.t)(i.minvalue))for(let e=0;e<i.minvalue.length;e++)"string"==typeof i.minvalue[e]&&(n=Object(X.d)(t,i.minvalue[e],a),0===o.min&&(o.min=n),n>0&&n<o.min&&(o.min=n))}if(!Object(h.t)(i.maxvalue))for(let t=0;t<i.maxvalue.length;t++)if("number"==typeof i.maxvalue[t]){o.max=i.maxvalue[t];break}if(!Object(h.t)(i.minvalue))for(let t=0;t<i.minvalue.length;t++)if("number"==typeof i.minvalue[t]){o.min=i.minvalue[t];break}if("fixedLeft"===i.method||"fixedRight"===i.method){const t=this.getMiddle(i.method);o.max===o.min&&(o.max>t&&(o.min=t),o.min<t&&(o.max=t));const e=Math.abs(o.max-t)/t,s=Math.abs(t-o.min)/t;e<.01&&s<.01&&this.static.stktype!==st.STOCK_TYPE_INDEX?(o.min=.99*t,o.max=1.01*t):e>s?o.min=t/(1+e):o.max=t*(1+s),o.min<0&&(o.min=0)}return o}readyScroll(){if("none"!==this.scroll.display&&void 0!==this.childCharts.HSCROLL){let t=Object(X.d)(this.data,"time",this.linkInfo.minIndex);t=Object(h.e)(this.data.key,t,this.father.dataLayer.tradeTime[0].begin);let i=Object(X.d)(this.data,"time",this.linkInfo.maxIndex);i=Object(h.e)(this.data.key,i,this.father.dataLayer.tradeTime[this.father.dataLayer.tradeTime.length-1].end);let e=Object(X.d)(this.data,"time",0);e=Object(h.e)(this.data.key,e,this.father.dataLayer.tradeTime[0].begin);let s=Object(X.d)(this.data,"time",this.data.value.length-1);s=Object(h.e)(this.data.key,s,this.father.dataLayer.tradeTime[this.father.dataLayer.tradeTime.length-1].end),this.childCharts.HSCROLL.onChange({head:e,tail:s,left:t,right:i,min:this.linkInfo.minIndex,max:this.linkInfo.maxIndex,range:this.data.value.length})}}getDataRange(t){const i={minIndex:-1,maxIndex:-1};if(Object(h.t)(t.value)||Object(h.t)(this.data.value))return i;const e=Object(X.d)(this.data,"time",this.linkInfo.minIndex),s=Object(X.d)(this.data,"time",this.linkInfo.maxIndex);for(let s=0;s<=t.value.length-1;s++)if(Object(X.d)(t,"time",s)>=e){i.minIndex=s;break}for(let e=t.value.length-1;e>=0;e--)if(Object(X.d)(t,"time",e)<=s){i.maxIndex=e;break}return i}locationData(){if(void 0===this.data)return;const t=Object(X.k)(this.data);"day1"===this.config.axisX.type?j(this.linkInfo,{width:this.rectChart.width,size:t,scale:this.scale,maxCount:Object(X.j)(this.father.dataLayer.tradeTime)}):"day5"===this.config.axisX.type?j(this.linkInfo,{width:this.rectChart.width,size:t,scale:this.scale,maxCount:5*Object(X.j)(this.father.dataLayer.tradeTime)}):function(t,i){const e=t.unitX/4;t.spaceX=e<i.scale?i.scale:e,t.maxCount=Math.floor(i.width/(t.unitX+t.spaceX));const s=t.maxCount>i.size?i.size:t.maxCount;switch(t.showMode){case"fixed":t.maxIndex=i.size-1,t.minIndex=i.size-s;break;case"locked":case"move":break;default:t.maxIndex=i.size-1,t.minIndex=i.size-s}}(this.linkInfo,{width:this.rectChart.width,scale:this.scale,size:t})}readyDraw(){let t,i;this.readyScroll();for(let e=0;e<this.config.lines.length;e++){if(void 0===this.config.lines[e].extremum)continue;if(Object(h.t)(this.config.lines[e].extremum.maxvalue)&&Object(h.t)(this.config.lines[e].extremum.minvalue))continue;const s=this.config.lines[e].formula;if(void 0!==s){const i=this.father.getData(s.key),h=this.getDataRange(i);t=this.calcMaxMin(i,this.config.lines[e].extremum,h.minIndex,h.maxIndex)}else t=this.calcMaxMin(this.data,this.config.lines[e].extremum,this.linkInfo.minIndex,this.linkInfo.maxIndex);void 0===i?i=t:(i.max=i.max>t.max?i.max:t.max,i.min=i.min<t.min?i.min:t.min)}this.maxmin.max=i.max,this.maxmin.min=i.min,this.maxmin.unitY=(this.rectChart.height-2)/(this.maxmin.max-this.maxmin.min)}onClick(t){"phone1"!==this.axisPlatform&&(this.linkInfo.showCursorLine=!this.linkInfo.showCursorLine,this.linkInfo.showCursorLine?this.father.eventLayer.boardEvent(this.father,"onMouseMove",t):(t.reDraw=!0,this.father.eventLayer.boardEvent(this.father,"onMouseOut",t)))}onLongPress(t){this.linkInfo.showCursorLine=!0,this.father.eventLayer.boardEvent(this.father,"onMouseMove",t)}onPinch(t){t.scale>0?this.config.zoomInfo.index++:this.config.zoomInfo.index--,this.config.zoomInfo.index<0?this.config.zoomInfo.index=0:(this.setZoomInfo(2*this.config.zoomInfo.index+1),this.father.onPaint())}onMouseOut(t){(this.linkInfo.showCursorLine||t.reDraw)&&(this.linkInfo.moveIndex=this.linkInfo.maxIndex,this.drawTitleInfo(this.linkInfo.moveIndex)),this.childDraws.CURSOR.onClear()}onMouseWheel(t){if(void 0===this.config.zoomInfo)return;let i,e=Math.floor(t.deltaY/10);0===e&&(e=t.deltaY>0?1:-1),(i=e>0?this.config.zoomInfo.index-1:this.config.zoomInfo.index+1)>=0&&i<=this.config.zoomInfo.list.length-1&&(this.config.zoomInfo.index=i,this.setZoomInfo(),this.father.onPaint())}onKeyDown(t){t.keyCode}onMouseMove(t){if(this.linkInfo.hideInfo)return;if(!this.linkInfo.showCursorLine)return;const i=t.mousePos,e=this.getMouseMoveData(i.x);let s,o=e;e>0&&("day1"===this.config.axisX.type||"day5"===this.config.axisX.type?(o%=240,o=Object(X.g)(o,this.father.dataLayer.tradeTime,this.father.dataLayer.tradeDate),s=function(t,i,e){for(let e=0;e<=t.value.length-1;e++)if(i===Object(X.d)(t,"idx",e))return e;return-1}(this.data,e)):(o=Object(X.d)(this.data,"time",e),s=e),Object(h.p)(this.rectChart,i.x)&&this.drawTitleInfo(s),this.linkInfo.moveIndex!==e&&(this.linkInfo.moveIndex=e,this.callback({event:"mousemove",before:e>0?Object(X.d)(this.data,"close",e-1):Object(X.d)(this.data,"open",0),data:this.data.value[e]}))),this.childDraws.CURSOR.onPaint(i,o,void 0)}getMouseMoveData(t){const i=Math.round((t-this.rectChart.left)/(this.linkInfo.unitX+this.linkInfo.spaceX)-.5);return"day1"===this.config.axisX.type?i:"day5"===this.config.axisX.type?i:this.linkInfo.minIndex+i}}class mt{constructor(t){F(this,t),this.linkInfo=t.linkInfo,this.static=this.father.dataLayer.static}init(t){this.rectMain=t.rectMain||{left:0,top:0,width:200,height:300},this.layout=Object(h.v)(t.layout,B),this.config=Object(h.v)(t.config,q),this.style=t.config.style||"normal",this.checkConfig(),this.setPublicRect()}checkConfig(){R(this.layout),this.txtLen=p(this.context,"涨",this.layout.digit.font,this.layout.digit.pixel),this.timeLen=p(this.context,"15:30",this.layout.digit.font,this.layout.digit.pixel),this.volLen=p(this.context,"888888",this.layout.digit.font,this.layout.digit.pixel),this.closeLen=p(this.context,"888.88",this.layout.digit.font,this.layout.digit.pixel)}setPublicRect(){this.rectChart=Object(h.u)(this.rectMain,this.layout.margin)}onClick(){this.isIndex||("normal"===this.style?this.style="tiny":this.style="normal",this.father.onPaint(this))}onPaint(){this.codeInfo=this.father.getData("INFO"),this.orderData=this.father.getData("NOW"),this.tickData=this.father.getData("TICK"),void 0!==this.orderData&&void 0!==this.tickData&&(this.orderData.coinunit=this.static.coinunit,this.tickData.coinunit=this.static.coinunit,this.isIndex=0===Object(X.d)(this.codeInfo,"type"),o(this.context,this.scale),this.drawClear(),this.drawReady(),this.isIndex?this.drawIndex():this.drawOrder(),this.drawTick())}drawClear(){d(this.context,this.rectMain.left,this.rectMain.top,this.rectMain.width,this.rectMain.height,this.color.back)}drawReady(){let t;void 0===this.tickData&&(this.tickData={key:"TICK",fields:st.FIELD_TICK,value:[]}),void 0===this.orderData&&(this.orderData={key:"NOW",fields:st.FIELD_NOW,value:[]}),t="normal"===this.style?this.rectChart.top+10*(this.layout.digit.height+this.layout.digit.spaceX):this.rectChart.top+2*(this.layout.digit.height+this.layout.digit.spaceX),this.isIndex?(t=this.rectChart.top+4*(this.layout.digit.height+this.layout.digit.spaceX),this.rectOrder={left:this.rectChart.left,top:this.rectChart.top,width:this.rectChart.width,height:t}):this.rectOrder={left:this.rectChart.left,top:this.rectChart.top,width:this.rectChart.width,height:t},"none"!==this.config.title.display?this.rectTitle={left:this.rectChart.left,top:t,width:this.rectChart.width,height:this.layout.title.height}:this.rectTitle={left:0,top:0,width:0,height:0},t+=this.rectTitle.height,this.rectTick={left:this.rectChart.left,top:t,width:this.rectChart.width,height:this.rectChart.height-t-this.layout.digit.height/2}}getColor(t,i){return t>i?this.color.red:t<i?this.color.green:this.color.white}drawIndex(){f(this.context,this.color.grid),c(this.context,this.rectMain.left,this.rectMain.top,this.rectMain.width,this.rectMain.height);const t=this.rectOrder.height/3,i=this.rectOrder.width/3;let e,s,o,n;s=this.rectOrder.top+Math.floor((t-this.layout.digit.height)/2),e=this.rectOrder.left+(i-this.txtLen)/2,g(this.context,e,s,"涨",this.layout.digit.font,this.layout.digit.pixel,this.color.txt),e=this.rectOrder.left+i+(i-this.txtLen)/2,g(this.context,e,s,"跌",this.layout.digit.font,this.layout.digit.pixel,this.color.txt),e=this.rectOrder.left+2*i+(i-this.txtLen)/2,g(this.context,e,s,"平",this.layout.digit.font,this.layout.digit.pixel,this.color.txt);const l={key:"NOW",fields:st.FIELD_NOW_IDX,value:this.orderData.value};if(s=this.rectOrder.top+t+Math.floor((t-this.layout.digit.height)/2),n=Object(h.f)(Object(X.d)(l,"ups")),o=p(this.context,n,this.layout.digit.font,this.layout.digit.pixel),e=this.rectOrder.left+(i-o)/2,g(this.context,e,s,n,this.layout.digit.font,this.layout.digit.pixel,this.color.txt),n=Object(h.f)(Object(X.d)(l,"downs")),o=p(this.context,n,this.layout.digit.font,this.layout.digit.pixel),e=this.rectOrder.left+i+(i-o)/2,g(this.context,e,s,n,this.layout.digit.font,this.layout.digit.pixel,this.color.txt),n=Object(h.f)(Object(X.d)(l,"mids")),o=p(this.context,n,this.layout.digit.font,this.layout.digit.pixel),e=this.rectOrder.left+2*i+(i-o)/2,g(this.context,e,s,n,this.layout.digit.font,this.layout.digit.pixel,this.color.txt),s=this.rectOrder.top+2*t+Math.floor((t-this.layout.digit.height)/2),n=Object(h.f)(Object(X.d)(l,"upvol")),o=p(this.context,n,this.layout.digit.font,this.layout.digit.pixel),e=this.rectOrder.left+(i-o)/2,g(this.context,e,s,n,this.layout.digit.font,this.layout.digit.pixel,this.color.txt),n=Object(h.f)(Object(X.d)(l,"downvol")),o=p(this.context,n,this.layout.digit.font,this.layout.digit.pixel),e=this.rectOrder.left+i+(i-o)/2,g(this.context,e,s,n,this.layout.digit.font,this.layout.digit.pixel,this.color.txt),"none"!==this.config.title.display){a(this.context,this.rectTitle.left,this.rectTitle.left+this.rectTitle.width,this.rectTitle.top),a(this.context,this.rectTitle.left,this.rectTitle.left+this.rectTitle.width,this.rectTitle.top+this.rectTitle.height);const t=p(this.context,"分时成交",this.layout.title.font,this.layout.digit.pixel);e=this.rectTitle.left+(this.rectTitle.width-t)/2,s=this.rectTitle.top+3*this.scale,g(this.context,e,s,"分时成交",this.layout.digit.font,this.layout.digit.pixel,this.color.txt)}u(this.context)}drawOrder(){const t=this.drawGridLine();if(void 0===this.orderData||this.orderData.value.length<1)return;const i=(this.rectOrder.width-t-2*this.layout.digit.spaceX-this.closeLen-this.volLen)/2;let e=1;"normal"===this.style&&(e=5);const s=this.rectOrder.height/(2*e);let o,n,a,l;n=this.rectOrder.top+Math.floor((s-this.layout.digit.height)/2);for(let r=e;r>=1;r--)o=this.rectOrder.left+t+i+this.closeLen,this.linkInfo.hideInfo||(a=Object(X.d)(this.orderData,"sell"+r),l=this.getColor(a,this.static.before),g(this.context,o,n,Object(h.d)(a,this.static.decimal),this.layout.digit.font,this.layout.digit.pixel,l,{x:"end"})),o+=i+this.volLen+this.layout.digit.spaceX,a=Object(X.d)(this.orderData,"sellvol"+r),l=this.color.vol,g(this.context,o,n,Object(h.f)(a,100),this.layout.digit.font,this.layout.digit.pixel,l,{x:"end"}),n+=s;for(let r=1;r<=e;r++)o=this.rectOrder.left+t+i+this.closeLen,this.linkInfo.hideInfo||(a=Object(X.d)(this.orderData,"buy"+r),l=this.getColor(a,this.static.before),g(this.context,o,n,Object(h.d)(a,this.static.decimal),this.layout.digit.font,this.layout.digit.pixel,l,{x:"end"})),o+=i+this.volLen+this.layout.digit.spaceX,a=Object(X.d)(this.orderData,"buyvol"+r),l=this.color.vol,g(this.context,o,n,Object(h.f)(a,100),this.layout.digit.font,this.layout.digit.pixel,l,{x:"end"}),n+=s}drawTick(){if(void 0===this.tickData||this.tickData.value.length<1)return;const t=Math.floor(this.rectTick.height/this.layout.digit.height)-1,i=this.tickData.value.length,e=i>t?i-t:0,s=this.rectTick.height/t;let o,n,a,l,r=(this.rectTick.width-4*this.layout.digit.spaceX-this.timeLen-this.closeLen-this.volLen)/2;this.isIndex&&(r=(this.rectTick.width-3*this.layout.digit.spaceX-this.timeLen-this.closeLen)/2),n=this.rectTick.top+2+Math.floor((s-this.layout.digit.pixel)/2);for(let t=i-1;t>=e;t--){let i;o=this.rectTick.left+this.layout.digit.spaceX+this.timeLen,a=Object(X.d)(this.tickData,"time",t),l=this.color.txt,i=0===t?Object(h.g)(a,"minute"):Object(h.g)(a,"minute",Object(X.d)(this.tickData,"time",t-1)),g(this.context,o,n,i,this.layout.digit.font,this.layout.digit.pixel,l,{x:"end"}),this.isIndex?(o=this.rectTick.left+this.rectTick.width-this.layout.digit.spaceX,a=Object(X.d)(this.tickData,"close",t),l=this.getColor(a,this.static.before),g(this.context,o,n,Object(h.d)(a,this.static.decimal),this.layout.digit.font,this.layout.digit.pixel,l,{x:"end"}),n+=s):(o+=r+this.closeLen+this.layout.digit.spaceX,this.linkInfo.hideInfo||(a=Object(X.d)(this.tickData,"close",t),l=this.getColor(a,this.static.before),g(this.context,o,n,Object(h.d)(a,this.static.decimal),this.layout.digit.font,this.layout.digit.pixel,l,{x:"end"})),o+=r+this.volLen+this.layout.digit.spaceX,a=Object(X.d)(this.tickData,"decvol",t),l=this.color.vol,g(this.context,o,n,Object(h.f)(a,100),this.layout.digit.font,this.layout.digit.pixel,l,{x:"end"}),n+=s)}}drawGridLine(){f(this.context,this.color.grid),c(this.context,this.rectMain.left,this.rectMain.top,this.rectMain.width,this.rectMain.height);let t=1;"normal"===this.style&&(t=5);let i,e,s,h=0;a(this.context,this.rectOrder.left,this.rectOrder.left+this.rectOrder.width,this.rectOrder.top+Math.floor(this.rectOrder.height/2));const o=["①","②","③","④","⑤"],n=this.rectOrder.height/(2*t);h=p(this.context,"卖①",this.layout.title.font,this.layout.digit.height),e=this.rectOrder.top+Math.floor((n-this.layout.digit.pixel)/2);for(let h=t-1;h>=0;h--)i=this.rectOrder.left+this.layout.digit.spaceX,s="卖"+o[h],g(this.context,i,e,s,this.layout.digit.font,this.layout.digit.pixel,this.color.txt),e+=n;for(let h=0;h<t;h++)i=this.rectOrder.left+this.layout.digit.spaceX,s="买"+o[h],g(this.context,i,e,s,this.layout.digit.font,this.layout.digit.pixel,this.color.txt),e+=n;if("none"!==this.config.title.display){a(this.context,this.rectTitle.left,this.rectTitle.left+this.rectTitle.width,this.rectTitle.top),a(this.context,this.rectTitle.left,this.rectTitle.left+this.rectTitle.width,this.rectTitle.top+this.rectTitle.height),s="normal"===this.style?"分时成交 △":"分时成交 ▽";const t=p(this.context,s,this.layout.title.font,this.layout.digit.pixel);i=this.rectTitle.left+(this.rectTitle.width-t)/2,e=this.rectTitle.top+3*this.scale,g(this.context,i,e,s,this.layout.digit.font,this.layout.digit.pixel,this.color.txt)}return u(this.context),h}}const xt={showMode:"last",fixed:{min:-1,max:-1,left:20,right:20},locked:{index:-1,set:.5},minIndex:-1,maxIndex:-1,hotIndex:-1,showCursorLine:!1,moveIndex:-1,spaceX:2,unitX:5,rightMode:"no",hideInfo:!1};class gt{constructor(t){this.context=t.mainCanvas.context,this.cursorCanvas=t.cursorCanvas,this.sysColor=t.sysColor,this.father=void 0}initChart(t,i){this.linkInfo=Object(h.b)(xt),this.childCharts={},this.setDataLayer(t),this.setEventLayer(i)}clear(){this.childCharts={},this.fastDraw=!1,this.dataLayer.clearData(),this.linkInfo=Object(h.b)(xt)}getChart(t){return this.childCharts[t]}getEventLayer(){return this.eventLayer}setEventLayer(t){void 0!==t&&(this.eventLayer=t,this.eventLayer.bindChart&&this.eventLayer.bindChart(this))}getDataLayer(){return this.dataLayer}setDataLayer(t){void 0!==t&&(this.dataLayer=t,t.father=this,this.static=this.dataLayer.static)}bindData(t,i){t.hotKey!==i&&(this.linkInfo.showMode="last",this.linkInfo.minIndex=-1,t.hotKey=i,this.fastDrawEnd())}initData(t,i){this.dataLayer.initData(t,i)}setData(t,i,e){let s=e;"string"==typeof e&&(s=JSON.parse(e)),this.dataLayer.setData(t,i,s),this.fastDrawEnd()}getData(t){if(this.fastDraw&&void 0!==this.fastBuffer[t])return this.fastBuffer[t];const i=this.dataLayer.getData(t,this.linkInfo.rightMode);return this.fastDraw&&(this.fastBuffer[t]=i),i}readyData(t,i){for(let e=0;e<i.length;e++)void 0!==i[e].formula&&(!this.fastDraw||this.fastDraw&&void 0===this.fastBuffer[i[e].formula.key])&&this.dataLayer.makeLineData({data:t,minIndex:this.linkInfo.minIndex,maxIndex:this.linkInfo.maxIndex},i[e].formula.key,i[e].formula.command)}createChart(t,i,e,s){let h;switch(i){case"CHART.ORDER":h=new mt(this);break;case"CHART.LINE":default:h=new ut(this)}return h.name=t,this.childCharts[t]=h,h.init(e,s),h}onPaint(t){"function"==typeof this.context._beforePaint&&this.context._beforePaint(),this.fastDrawBegin();for(const i in this.childCharts)void 0!==t?this.childCharts[i]===t&&this.childCharts[i].onPaint():this.childCharts[i].onPaint();"function"==typeof this.context._afterPaint&&this.context._afterPaint()}fastDrawBegin(){this.fastDraw||(this.fastBuffer=[],this.fastDraw=!0)}fastDrawEnd(){this.fastDraw=!1}setHideInfo(t){void 0!==t&&t!==this.linkInfo.hideInfo&&(this.linkInfo.hideInfo=t,this.onPaint())}setColor(t,i){this.color=S(t),void 0===i&&(i=this);for(const e in i.childCharts)i.childCharts[e].color=this.color,this.setColor(t,i.childCharts[e]);for(const e in i.childDraws)i.childDraws[e].color=this.color,this.setColor(t,i.childDraws[e]);for(const e in i.childLines)i.childLines[e].color=this.color,this.setColor(t,i.childLines[e])}setStandard(t){!function(t){_.standard=t||"china"}(t),this.setColor(this.sysColor),this.onPaint()}}function vt(){return(new Date).getTime()}function pt(t,i){return Math.sqrt(t*t+i*i)}function yt(t,i){const e={name:"touch"};let s={left:0,top:0};return void 0!==i&&(s=i.getBoundingClientRect()),e.offsetX=t.pageX-s.left,e.offsetY=t.pageY-s.top,e}class bt{constructor(t){this.father=t,this.eventCanvas=t.eventCanvas,this.isSupportTouch=!!("ontouchend"in document),this.eventCanvas.addEventListener&&this.eventCanvas.addEventListener("contextmenu",t=>{t.preventDefault()})}bindEvent(){this.isSupportTouch?(this.addHandler("touchstart",this.touchstart.bind(this)),this.addHandler("touchend",this.touchend.bind(this)),this.addHandler("touchmove",this.touchmove.bind(this))):(this.addHandler("mousemove",this.mousemove.bind(this)),this.addHandler("mouseout",this.mouseout.bind(this)),this.addHandler("mousewheel",this.mousewheel.bind(this)),this.addHandler("mouseup",this.mouseup.bind(this)),this.addHandler("mousedown",this.mousedown.bind(this)),this.addHandler("keyup",this.keyup.bind(this)),this.addHandler("keydown",this.keydown.bind(this)),this.addHandler("click",this.click.bind(this)))}clearEvent(){this.isSupportTouch?(this.clearHandler("touchstart",this.touchstart.bind(this)),this.clearHandler("touchend",this.touchend.bind(this)),this.clearHandler("touchmove",this.touchmove.bind(this))):(this.clearHandler("mousemove",this.mousemove.bind(this)),this.clearHandler("mouseout",this.mouseout.bind(this)),this.clearHandler("mousewheel",this.mousewheel.bind(this)),this.clearHandler("mouseup",this.mouseup.bind(this)),this.clearHandler("mousedown",this.mousedown.bind(this)),this.clearHandler("keyup",this.keyup.bind(this)),this.clearHandler("keydown",this.keydown.bind(this)),this.clearHandler("click",this.click.bind(this)))}addHandler(t,i){this.eventCanvas.addEventListener?this.eventCanvas.addEventListener(t,i,!1):this.eventCanvas.attachEvent?this.eventCanvas.attachEvent("on"+t,i):this.eventCanvas["on"+t]=i}clearHandler(t,i){this.eventCanvas.removeEventListener?this.eventCanvas.removeEventListener(t,i,!1):this.eventCanvas.deattachEvent?this.eventCanvas.deattachEvent("on"+t,i):this.eventCanvas["on"+t]=null}getEventInfo(t){return{offsetX:t.offsetX,offsetY:t.offsetY}}mousemove(t){this.father.emitEvent("onMouseMove",this.getEventInfo(t))}mousein(t){this.father.emitEvent("onMouseIn",this.getEventInfo(t))}mouseout(t){this.father.emitEvent("onMouseOut",this.getEventInfo(t))}mousewheel(t){const i=this.getEventInfo(t);i.deltaY=t.deltaY,this.father.emitEvent("onMouseWheel",i)}mouseup(t){this.father.emitEvent("onMouseUp",this.getEventInfo(t))}mousedown(t){this.father.emitEvent("onMouseDown",this.getEventInfo(t))}keyup(t){const i=this.getEventInfo(t);i.keyCode=t.keyCode,this.father.emitEvent("onKeyUp",i)}keydown(t){const i=this.getEventInfo(t);i.keyCode=t.keyCode,this.father.emitEvent("onKeyDown",i)}click(t){this.father.emitEvent("onClick",this.getEventInfo(t))}touchstart(t){this.__timestamp=new Date;const i=t.touches?t.touches[0]:t;if(this.startX=i.pageX,this.startY=i.pageY,window.clearTimeout(this.longTapTimeout),t.touches.length>1){const i=t.touches[1],e=Math.abs(i.pageX-this.startX),s=Math.abs(i.pageY-this.startY);this.touchDistance=pt(e,s),this.touchVector={x:i.pageX-this.startX,y:i.pageY-this.startY},this.startTime=vt()}else this.startTime=vt(),this.longTapTimeout=setTimeout(()=>{this.father.emitEvent("onLongPress",yt(i,t.srcElement))},600),this.previousTouchPoint&&Math.abs(this.startX-this.previousTouchPoint.startX)<10&&Math.abs(this.startY-this.previousTouchPoint.startY)<10&&Math.abs(this.startTime-this.previousTouchTime)<300&&this.father.emitEvent("onDBClick",yt(i,t.srcElement)),this.previousTouchTime=this.startTime,this.previousTouchPoint={startX:this.startX,startY:this.startY}}touchend(t){const i=t.changedTouches?t.changedTouches[0]:t;window.clearTimeout(this.longTapTimeout);const e=vt();null!==this.moveX&&Math.abs(this.moveX-this.startX)>10||null!==this.moveY&&Math.abs(this.moveY-this.startY)>10?e-this.startTime<500&&this.father.emitEvent("onSwipe",yt(i,t.srcElement)):e-this.startTime<2e3&&(e-this.startTime<500&&this.father.emitEvent("onClick",yt(i,t.srcElement)),e-this.startTime>500&&this.father.emitEvent("onLongPress",yt(i,t.srcElement))),this.startX=this.startY=this.moveX=this.moveY=null,this.previousPinchScale=1,this.father.emitEvent("onMouseOut",yt(i,t.srcElement))}touchmove(t){if(new Date-this.__timestamp<150)return t;const i=vt();if(t.touches.length>1){const e=pt(Math.abs(t.touches[0].pageX-t.touches[1].pageX),Math.abs(t.touches[1].pageY-t.touches[1].pageY));if(this.touchDistance){const s=e/this.touchDistance,h=yt(t.touches?t.touches[0]:t,t.srcElement);i-this.startTime>90&&this.previousPinchScale&&(h.scale=s-this.previousPinchScale,Math.abs(h.scale)>.01&&this.father.emitEvent("onPinch",h),this.startTime=vt()),this.previousPinchScale=s}if(this.touchVector){const i={x:t.touches[1].pageX-t.touches[0].pageX,y:t.touches[1].pageY-t.touches[0].pageY},e=function(t,i){let e=function(t,i){return t.x*i.y-i.x*t.y}(t,i);e=e>0?-1:1;const s=pt(t.x,t.y)*pt(i.x,i.y);if(0===s)return 0;let h=(t.x*i.x+t.y*i.y)/s;return h>1&&(h=1),h<-1&&(h=-1),Math.acos(h)*e*180/Math.PI}(i,this.touchVector);this.father.emitEvent("onRotate",{angle:e}),this.touchVector.x=i.x,this.touchVector.y=i.y}}else{window.clearTimeout(this.longTapTimeout);const i=t.touches?t.touches[0]:t,e=null===this.moveX?0:i.pageX-this.moveX,s=null===this.moveY?0:i.pageY-this.moveY,h=yt(i,t.srcElement);h.deltaX=e,h.deltaY=s,this.father.emitEvent("onMouseMove",h),this.moveX=i.pageX,this.moveY=i.pageY}t.preventDefault()}}function Mt(){return(new Date).getTime()}function It(t,i){return Math.sqrt(t*t+i*i)}function wt(t){const i={name:"touch"};return i.offsetX=t.offsetX-0,i.offsetY=t.offsetY-0,i}class Dt{constructor(t){this.father=t,this.eventCanvas=t.eventCanvas}bindEvent(){this.addHandler("touchstart",this.touchstart.bind(this)),this.addHandler("touchend",this.touchend.bind(this)),this.addHandler("touchmove",this.touchmove.bind(this))}clearEvent(){this.clearHandler("touchstart",this.touchstart.bind(this)),this.clearHandler("touchend",this.touchend.bind(this)),this.clearHandler("touchmove",this.touchmove.bind(this))}addHandler(t,i){this.eventCanvas.on(t,i)}clearHandler(t,i){this.eventCanvas.removeListener(t,i)}getEventInfo(t){return{offsetX:t.offsetX,offsetY:t.offsetY}}touchstart(t){this.__timestamp=new Date;const i=t.touches?t.touches[0]:t;if(this.startX=i.pageX,this.startY=i.pageY,clearTimeout(this.longTapTimeout),t.touches.length>1){const i=t.touches[1],e=Math.abs(i.pageX-this.startX),s=Math.abs(i.pageY-this.startY);this.touchDistance=It(e,s),this.touchVector={x:i.pageX-this.startX,y:i.pageY-this.startY},this.startTime=Mt()}else this.startTime=Mt(),this.longTapTimeout=setTimeout(()=>{this.father.emitEvent("onLongPress",wt(i))},600),this.previousTouchPoint&&Math.abs(this.startX-this.previousTouchPoint.startX)<10&&Math.abs(this.startY-this.previousTouchPoint.startY)<10&&Math.abs(this.startTime-this.previousTouchTime)<300&&this.father.emitEvent("onDBClick",wt(i)),this.previousTouchTime=this.startTime,this.previousTouchPoint={startX:this.startX,startY:this.startY}}touchend(t){const i=t.changedTouches?t.changedTouches[0]:t;clearTimeout(this.longTapTimeout);const e=Mt();null!==this.moveX&&Math.abs(this.moveX-this.startX)>10||null!==this.moveY&&Math.abs(this.moveY-this.startY)>10?e-this.startTime<500&&this.father.emitEvent("onSwipe",wt(i)):e-this.startTime<2e3&&(e-this.startTime<500&&this.father.emitEvent("onClick",wt(i)),e-this.startTime>500&&this.father.emitEvent("onLongPress",wt(i))),this.startX=this.startY=this.moveX=this.moveY=null,this.previousPinchScale=1,this.father.emitEvent("onMouseOut",wt(i))}touchmove(t){if(new Date-this.__timestamp<150)return t;const i=Mt();if(t.touches.length>1){const e=It(Math.abs(t.touches[0].pageX-t.touches[1].pageX),Math.abs(t.touches[1].pageY-t.touches[1].pageY));if(this.touchDistance){const s=e/this.touchDistance,h=wt(t.touches?t.touches[0]:t);i-this.startTime>90&&this.previousPinchScale&&(h.scale=s-this.previousPinchScale,Math.abs(h.scale)>.01&&this.father.emitEvent("onPinch",h),this.startTime=Mt()),this.previousPinchScale=s}if(this.touchVector){const i={x:t.touches[1].pageX-t.touches[0].pageX,y:t.touches[1].pageY-t.touches[0].pageY},e=function(t,i){let e=function(t,i){return t.x*i.y-i.x*t.y}(t,i);e=e>0?-1:1;const s=It(t.x,t.y)*It(i.x,i.y);if(0===s)return 0;let h=(t.x*i.x+t.y*i.y)/s;return h>1&&(h=1),h<-1&&(h=-1),Math.acos(h)*e*180/Math.PI}(i,this.touchVector);this.father.emitEvent("onRotate",{angle:e}),this.touchVector.x=i.x,this.touchVector.y=i.y}}else{clearTimeout(this.longTapTimeout);const i=t.touches?t.touches[0]:t,e=null===this.moveX?0:i.pageX-this.moveX,s=null===this.moveY?0:i.pageY-this.moveY,h=wt(i);h.deltaX=e,h.deltaY=s,this.father.emitEvent("onMouseMove",h),this.moveX=i.pageX,this.moveY=i.pageY}}}function kt(){return(new Date).getTime()}function Ot(t,i){return Math.sqrt(t*t+i*i)}function Ct(t){const i={name:"touch"};return i.offsetX=t.x-0,i.offsetY=t.y-0,i}class Tt{constructor(t){this.father=t,this.eventCanvas=t.eventCanvas}bindEvent(){this.addHandler("touchstart",this.touchstart.bind(this)),this.addHandler("touchend",this.touchend.bind(this)),this.addHandler("touchmove",this.touchmove.bind(this))}clearEvent(){this.clearHandler("touchstart",this.touchstart.bind(this)),this.clearHandler("touchend",this.touchend.bind(this)),this.clearHandler("touchmove",this.touchmove.bind(this))}addHandler(t,i){this.eventCanvas.on(t,i)}clearHandler(t,i){this.eventCanvas.removeListener(t,i)}getEventInfo(t){return{offsetX:t.offsetX,offsetY:t.offsetY}}touchstart(t){this.__timestamp=new Date;const i=t.touches?t.touches[0]:t;if(this.startX=i.x,this.startY=i.y,clearTimeout(this.longTapTimeout),t.touches.length>1){const i=t.touches[1],e=Math.abs(i.x-this.startX),s=Math.abs(i.y-this.startY);this.touchDistance=Ot(e,s),this.touchVector={x:i.x-this.startX,y:i.y-this.startY},this.startTime=kt()}else this.startTime=kt(),this.longTapTimeout=setTimeout(()=>{this.father.emitEvent("onLongPress",Ct(i))},600),this.previousTouchPoint&&Math.abs(this.startX-this.previousTouchPoint.startX)<10&&Math.abs(this.startY-this.previousTouchPoint.startY)<10&&Math.abs(this.startTime-this.previousTouchTime)<300&&this.father.emitEvent("onDBClick",Ct(i)),this.previousTouchTime=this.startTime,this.previousTouchPoint={startX:this.startX,startY:this.startY}}touchend(t){const i=t.changedTouches?t.changedTouches[0]:t;clearTimeout(this.longTapTimeout);const e=kt();null!==this.moveX&&Math.abs(this.moveX-this.startX)>10||null!==this.moveY&&Math.abs(this.moveY-this.startY)>10?e-this.startTime<500&&this.father.emitEvent("onSwipe",Ct(i)):e-this.startTime<2e3&&(e-this.startTime<500&&this.father.emitEvent("onClick",Ct(i)),e-this.startTime>500&&this.father.emitEvent("onLongPress",Ct(i))),this.startX=this.startY=this.moveX=this.moveY=null,this.previousPinchScale=1,this.father.emitEvent("onMouseOut",Ct(i))}touchmove(t){if(new Date-this.__timestamp<150)return t;const i=kt();if(t.touches.length>1){const e=Ot(Math.abs(t.touches[0].x-t.touches[1].x),Math.abs(t.touches[1].y-t.touches[1].y));if(this.touchDistance){const s=e/this.touchDistance,h=Ct(t.touches?t.touches[0]:t);i-this.startTime>90&&this.previousPinchScale&&(h.scale=s-this.previousPinchScale,Math.abs(h.scale)>.01&&this.father.emitEvent("onPinch",h),this.startTime=kt()),this.previousPinchScale=s}if(this.touchVector){const i={x:t.touches[1].x-t.touches[0].x,y:t.touches[1].y-t.touches[0].y},e=function(t,i){let e=function(t,i){return t.x*i.y-i.x*t.y}(t,i);e=e>0?-1:1;const s=Ot(t.x,t.y)*Ot(i.x,i.y);if(0===s)return 0;let h=(t.x*i.x+t.y*i.y)/s;return h>1&&(h=1),h<-1&&(h=-1),Math.acos(h)*e*180/Math.PI}(i,this.touchVector);this.father.emitEvent("onRotate",{angle:e}),this.touchVector.x=i.x,this.touchVector.y=i.y}}else{clearTimeout(this.longTapTimeout);const i=t.touches?t.touches[0]:t,e=null===this.moveX?0:i.x-this.moveX,s=null===this.moveY?0:i.y-this.moveY,h=Ct(i);h.deltaX=e,h.deltaY=s,this.father.emitEvent("onMouseMove",h),this.moveX=i.x,this.moveY=i.y}}}class Xt{constructor(t){this.eventCanvas=t.cursorCanvas.canvas,this.eventPlatform=t.eventPlatform||"html5",this.scale=t.scale,"react-native"===this.eventPlatform?(this.eventSource=new Dt(this),this.eventSource.bindEvent()):"html5"===this.eventPlatform?(this.eventSource=new bt(this),this.eventSource.bindEvent()):"mina"===this.eventPlatform&&(this.eventSource=new Tt(this),this.eventSource.bindEvent())}bindChart(t){this.firstChart=t,this.HotWin=void 0}clearEvent(){this.eventSource.clearEvent()}emitEvent(t,i){if("onMouseOut"===t||"onMouseMove"===t)return this.boardEvent(this.firstChart,t,i),void(this.HotWin=void 0);const e=this.getMousePos(i),s=[];for(const t in this.firstChart.childCharts)if(Object(h.r)(this.firstChart.childCharts[t].rectMain,e)){this.findEventPath(s,this.firstChart.childCharts[t],e);break}if(s.length<1)return;const o=Object(h.b)(i);for(let i=s.length-1;i>=0&&(void 0===s[i][t]||(o.mousePos={x:e.x,y:e.y},s[i][t](o),!o.break));i--);}boardEvent(t,i,e,s){const o=Object(h.b)(e),n=this.getMousePos(e);for(const e in t.childCharts)if(t.childCharts[e]!==s&&void 0!==t.childCharts[e][i]&&(o.mousePos={x:n.x,y:n.y},t.childCharts[e][i](o),o.break))break}findEventPath(t,i,e){if(t.push(i),void 0!==i.childCharts)for(const s in i.childCharts)Object(h.r)(i.childCharts[s].rectMain,e)&&this.findEventPath(t,i.childCharts[s],e)}getMousePos(t){return{x:t.offsetX*this.scale,y:t.offsetY*this.scale}}}var Yt=e(3);class jt{constructor(){this.static={stktype:1,volunit:100,coinunit:100,decimal:2,before:1e3,stophigh:1100,stoplow:900}}initData(t,i){this.formula=new Yt.a,this.clearData(),this.tradeTime=void 0===i?[{begin:930,end:1130},{begin:1300,end:1500}]:i,this.tradeDate=void 0===t?Object(h.h)():t}clearData(){this.InData=[],this.OutData=[]}setData(t,i,e){switch(void 0===e&&(e=[]),void 0===this.InData[t]&&(this.InData[t]={}),t){case"DAY5":e=Object(X.a)(e,this.static.coinunit,this.tradeDate,this.tradeTime);break;case"NOW":case"ENOW":this.flushNowData(t,e);break;case"MIN":case"DAY":e=Object(X.b)(e,this.tradeDate);break;case"INFO":this.static=Object(X.p)(st.FIELD_INFO,e);break;case"CODE":this.static=Object(X.p)(st.FIELD_CODE,e)}this.InData[t]={key:t,fields:i},this.InData[t].value=Object(h.a)(e)}flushTick(t,i){Object(X.k)(this.InData.TICK)<1?t[i.vol]>0&&(this.InData.TICK={key:"TICK",fields:st.FIELD_TICK,value:[t[i.time],t[i.close],t[i.vol]]}):(this.InData.TICK.value[this.InData.TICK.value.length-1][st.FIELD_TICK.vol]<t[i.vol]||this.InData.TICK.value[this.InData.TICK.value.length-1][st.FIELD_TICK.close]!==t[i.close])&&this.InData.TICK.value.push([t[i.time],t[i.close],t[i.vol]])}flushMin(t,i){if(void 0===this.InData.MIN)this.InData.MIN={key:"MIN",fields:st.FIELD_MIN,value:[Object(X.h)(t[i.time],this.tradeTime),t[i.open],t[i.high],t[i.low],t[i.close],t[i.vol],t[i.money]]};else{const e=Object(X.h)(t[i.time],this.tradeTime),s=Object(X.f)(this.InData.MIN,e);"old"===s.status?(this.InData.MIN.value[s.index][i.high]<t[i.close]&&(this.InData.MIN.value[s.index][i.high]=t[i.close]),this.InData.MIN.value[s.index][i.low]>t[i.close]&&(this.InData.MIN.value[s.index][i.low]=t[i.close]),this.InData.MIN.value[s.index][i.close]=t[i.close],this.InData.MIN.value[s.index][i.vol]=t[i.vol],this.InData.MIN.value[s.index][i.money]=t[i.money]):"new"===s.status&&this.InData.MIN.value.push([e,t[i.close],t[i.close],t[i.close],t[i.close],t[i.vol],t[i.money]])}}flushNowData(t,i){if(i.length<1)return;let e=st.FIELD_NOW;"ENOW"===t&&(e=st.FIELD_ENOW),Object(X.c)(i,e)||(this.flushTick(i,e),this.flushMin(i,e))}getData(t,i){switch(t){case"DAY":this.OutData.DAY={key:t,fields:st.FIELD_DAY},this.OutData.DAY.value=this.mergeDay(this.InData.DAY,this.InData.NOW,i);break;case"WEEK":this.OutData.WEEK={key:t,fields:st.FIELD_DAY},this.OutData.WEEK.value=this.mergeWeek(this.InData.DAY,this.InData.NOW,i);break;case"MON":this.OutData.MON={key:t,fields:st.FIELD_DAY},this.OutData.MON.value=this.mergeMon(this.InData.DAY,this.InData.NOW,i);break;case"DAY5":this.OutData.DAY5={key:t,fields:st.FIELD_DAY5},this.OutData.DAY5.value=this.mergeDay5(this.InData.DAY5,this.InData.MIN);break;case"M5":case"M15":case"M30":case"M60":this.OutData[t]={key:t,fields:st.FIELD_DAY},this.OutData[t].value=this.makeMinute(t,this.InData[t],this.InData.MIN,i);break;case"MIN":this.OutData[t]={key:t,fields:st.FIELD_MIN},this.OutData[t].value=this.updateMinute(this.InData[t])}return this.OutData[t]?this.OutData[t]:this.InData[t]}updateMinute(t){let i,e=Object(h.a)(t.value);for(let t=0;t<e.length;t++)0===this.static.stktype&&(0===t?i=e[t][st.FIELD_MIN.vol]*e[t][st.FIELD_MIN.close]/this.static.coinunit:i+=(e[t][st.FIELD_MIN.vol]-e[t-1][st.FIELD_MIN.vol])*e[t][st.FIELD_MIN.close]/this.static.coinunit,e[t][st.FIELD_MIN.allmoney]=i);return e}mergeDay(t,i,e){let s=Object(h.a)(t.value);if(void 0!==i&&!Object(X.c)(i.value,i.fields)){const e=Object(X.e)(t,Object(h.h)(i.value[i.fields.time]));e.finded?s[e.index]=[Object(h.h)(i.value[i.fields.time]),i.value[i.fields.open],i.value[i.fields.high],i.value[i.fields.low],i.value[i.fields.close],i.value[i.fields.vol],i.value[i.fields.money]]:s.push([Object(h.h)(i.value[i.fields.time]),i.value[i.fields.open],i.value[i.fields.high],i.value[i.fields.low],i.value[i.fields.close],i.value[i.fields.vol],i.value[i.fields.money]])}return this.InData.RIGHT&&"none"!==e&&(s=Object(X.n)(s,this.static.coinunit,this.InData.RIGHT.value,e,0,s.length-1)),s}mergeWeek(t,i,e){const s=this.mergeDay(t,i,e);return Object(X.m)(s)}mergeMon(t,i,e){const s=this.mergeDay(t,i,e);return Object(X.l)(s)}mergeDay5(t,i){let e=[];if(void 0!==t&&!Object(h.t)(t.value)&&(e=Object(h.a)(t.value),Object(h.h)(t.value[t.value.length-1][t.fields.time])===this.tradeDate))return e;if(void 0===i||Object(h.t)(i.value))return e;const s=4*Object(X.j)(this.tradeTime);let o;for(let t=0;t<i.value.length;t++)0===this.static.stktype?0===t?o=i.value[t][i.fields.vol]*i.value[t][i.fields.close]/this.static.coinunit:o+=(i.value[t][i.fields.vol]-i.value[t-1][i.fields.vol])*i.value[t][i.fields.close]/this.static.coinunit:o=i.value[t][i.fields.money],e.push([Object(X.g)(i.value[t][i.fields.idx],this.tradeTime,this.tradeDate),i.value[t][i.fields.close],0===t?i.value[t][i.fields.vol]:i.value[t][i.fields.vol]-i.value[t-1][i.fields.vol],s+i.value[t][i.fields.idx],i.value[t][i.fields.vol],o]);return e}makeMinute(t,i,e,s){let o=[];if(void 0!==i&&!Object(h.t)(i.value)&&(o=Object(h.a)(i.value),o=Object(X.o)(o,this.static.coinunit,this.InData.RIGHT.value,s,0,o.length-1),Object(h.h)(i.value[i.value.length-1][i.fields.time])===this.tradeDate))return o;if(void 0!==e&&!Object(h.t)(e.value)){let i=5;"M15"===t&&(i=15),"M30"===t&&(i=30),"M60"===t&&(i=60),o=this.mergeNowMinToMin(o,e,i)}return o}mergeNowMinToMin(t,i,e){const s=[];let o=0,n=0,a=!1,l=4;for(let r=0;r<i.value.length;r++){const c=i.value[r][i.fields.idx];c<0||(c>l?(a&&(s[i.fields.vol]=i.value[r][i.fields.vol]-o,s[i.fields.money]=i.value[r][i.fields.money]-n,o=i.value[r][i.fields.vol],n=i.value[r][i.fields.money],s[i.fields.time]=Object(X.g)(l,this.tradeTime,this.tradeDate),t.push(Object(h.a)(s))),l=(Math.floor(c/e)+1)*e-1,s[i.fields.open]=i.value[r][i.fields.open],s[i.fields.high]=i.value[r][i.fields.high],s[i.fields.low]=i.value[r][i.fields.low],s[i.fields.close]=i.value[r][i.fields.close],a=!0):a?(s[i.fields.high]=s[i.fields.high]>i.value[r][i.fields.high]?s[i.fields.high]:i.value[r][i.fields.high],s[i.fields.low]=s[i.fields.low]<i.value[r][i.fields.low]||0===i.value[r][i.fields.low]?s[i.fields.low]:i.value[r][i.fields.low],s[i.fields.close]=i.value[r][i.fields.close]):(s[i.fields.open]=i.value[r][i.fields.open],s[i.fields.high]=i.value[r][i.fields.high],s[i.fields.low]=i.value[r][i.fields.low],s[i.fields.close]=i.value[r][i.fields.close],a=!0))}return a&&(s[i.fields.vol]=i.value[i.value.length-1][i.fields.vol]-o,s[i.fields.money]=i.value[i.value.length-1][i.fields.money]-n,s[i.fields.time]=Object(X.g)(l,this.tradeTime,this.tradeDate),t.push(Object(h.a)(s))),t}makeLineData(t,i,e){const s=this.formula.runSingleStock(t,e);return void 0===this.OutData[i]?this.OutData[i]={outkey:i,fields:st.FIELD_ILINE,value:s}:this.OutData[i].value=s,this.OutData[i]}}const Et={start:1,period:2,buy:3,target:4,stoploss:5,status:6,uid:11,focused:12};var Lt={CHART_SEER:{zoomInfo:{index:3,list:[1,2,4,5,7,9,12,15,19]},scroll:{display:"none"},title:{display:"none"},axisX:{lines:0,display:"both",type:"normal",format:"date"},axisY:{lines:3,left:{display:"both",middle:"none",format:"price"},right:{display:"both",middle:"none",format:"price"}},lines:[{className:z,extremum:{method:"normal",maxvalue:["high"],minvalue:["low"]}},{className:V},{className:class{constructor(t,i){F(this,t),this.rectMain=i,this.linkInfo=t.father.linkInfo,this.source=t.father,this.static=t.father.static,this.maxmin=t.maxmin,this.layout=t.layout}getSeerPos(t,i){const e=t-this.linkInfo.minIndex;if(e<0||t>this.linkInfo.maxIndex)return{visible:!1};const s=this.rectMain.left+e*(this.linkInfo.unitX+this.linkInfo.spaceX)+Math.floor(this.linkInfo.unitX/2);let h=i;return void 0===i&&(h=Object(X.d)(this.data,"close",t)),{visible:!0,xx:s,yy:this.rectMain.top+Math.round((this.maxmin.max-h)*this.maxmin.unitY)}}drawHotSeer(t){let i=Y(this.data,Object(X.d)(this.sourceSeer,"start",t),"time","forword");-1===i&&(i=this.linkInfo.maxIndex);const e=i-this.linkInfo.minIndex;if(e<0)return;const s=this.rectMain.left+e*(this.linkInfo.unitX+this.linkInfo.spaceX)+Math.floor(this.linkInfo.unitX/2),o=Object(X.d)(this.sourceSeer,"status",t),n=Object(X.d)(this.sourceSeer,"buy",t);let a=n,l=this.rectMain.top+Math.round((this.maxmin.max-a)*this.maxmin.unitY),r=this.linkInfo.hideInfo?"买点":"买点:"+Object(h.d)(a,this.static.decimal);0===n&&(r="停牌中",a=Object(X.d)(this.data,"close",i),l=this.rectMain.top+Math.round((this.maxmin.max-a)*this.maxmin.unitY));let c=this.color.vol;Object(h.o)(o,[1,20,300])?c=this.color.txt:Object(h.o)(o,[2])&&(r="停牌中"),k(this.context,{linew:this.scale,xx:s,yy:l,right:this.rectMain.left+this.rectMain.width+this.layout.offset.right-2*this.scale,clr:c,bakclr:this.color.back,font:this.layout.title.font,pixel:this.layout.title.pixel,spaceX:4*this.scale,spaceY:3*this.scale,x:"start",y:"middle"},[{txt:r,set:100,display:!this.linkInfo.hideInfo}]);const d=Object(X.d)(this.sourceSeer,"period",t),x=d-(this.linkInfo.maxIndex-i);let g=" 周期:["+d+"天]";x>0&&(g+=" 剩余:["+x+"天]"),function(t,i,e){f(t,i.clr),m(t,i.xx,i.yy,i.xx,i.bottom-i.pixel/2,7),u(t);const s=i.spaceX||2*i.linew,h=i.spaceY||i.linew;i.height=i.bottom-i.yy;for(let o=0;o<e.length;o++){if("false"===e[o].display)continue;let n=i.yy+i.height*e[o].set/100;if("arc"===e[o].txt)n+e[o].maxR>i.bottom&&(n=i.bottom-e[o].maxR),D(t,i.xx,n,{r:e[o].maxR,clr:i.clr},{r:e[o].minR,clr:i.bakclr});else{const a=y(t,e[o].txt,{font:i.font,pixel:i.pixel,spaceX:s,spaceY:h});n+a.height>i.bottom&&(n=i.bottom-a.height);let l=i.xx;i.left&&l<i.left+a.width/2&&(l=i.left+a.width/2),b(t,l,n,e[o].txt,{font:i.font,pixel:i.pixel,clr:i.clr,bakclr:i.bakclr,x:"center",y:"middle",spaceX:s,spaceY:h})}}}(this.context,{linew:this.scale,xx:s,yy:l,left:this.rectMain.left,bottom:this.rectMain.top+this.rectMain.height+this.layout.offset.bottom+2*this.scale,clr:c,bakclr:this.color.back,font:this.layout.title.font,pixel:this.layout.title.pixel,spaceX:2*this.scale,paceY:2*this.scale},[{txt:"arc",set:0,minR:0,maxR:3*this.scale,display:!0},{txt:Object(X.d)(this.sourceSeer,"start",t)+g,set:100,display:!0}]),this.drawTransRect(this.rectMain.left,s);const v=s+d*(this.linkInfo.spaceX+this.linkInfo.unitX);if(this.drawTransRect(v,this.rectMain.left+this.rectMain.width),0===n)return;let p;a=Object(X.d)(this.sourceSeer,"stoploss",t);let M=this.rectMain.top+Math.round((this.maxmin.max-a)*this.maxmin.unitY);p=M-l>1.5*this.layout.title.pixel?[{txt:"arc",set:0,minR:0,maxR:2*this.scale,display:!0},{txt:this.linkInfo.hideInfo?"止损":"止损:"+Object(h.d)(a,this.static.decimal),set:100,display:!this.linkInfo.hideInfo}]:[{txt:"arc",set:0,minR:0,maxR:2*this.scale,display:!0},{txt:"arc",set:100,minR:0,maxR:1*this.scale,display:!0}],Object(h.q)(this.rectMain,l)&&k(this.context,{linew:this.scale,xx:s,yy:M,right:this.rectMain.left+this.rectMain.width+this.layout.offset.right-2*this.scale,clr:this.color.green,bakclr:this.color.back,font:this.layout.title.font,pixel:this.layout.title.pixel,spaceX:4*this.scale,spaceY:3*this.scale,x:"start",y:"middle"},p),a=Object(X.d)(this.sourceSeer,"target",t),p=l-(M=this.rectMain.top+Math.round((this.maxmin.max-a)*this.maxmin.unitY))>1.5*this.layout.title.pixel?[{txt:"arc",set:0,minR:0,maxR:2*this.scale,display:!0},{txt:this.linkInfo.hideInfo?"目标":"目标:"+Object(h.d)(a,this.static.decimal),set:100,display:!this.linkInfo.hideInfo}]:[{txt:"arc",set:0,minR:0,maxR:2*this.scale,display:!0},{txt:"arc",set:100,minR:0,maxR:2*this.scale,display:!0}],Object(h.q)(this.rectMain,l)&&k(this.context,{linew:this.scale,xx:s,yy:M,right:this.rectMain.left+this.rectMain.width+this.layout.offset.right-2*this.scale,clr:this.color.red,bakclr:this.color.back,font:this.layout.title.font,pixel:this.layout.title.pixel,spaceX:4*this.scale,spaceY:3*this.scale,x:"start",y:"middle"},p);const I=Object(X.d)(this.sourceSeer,"stop",t);if(Object(h.o)(o,[101,102,200,201,202,300])){const i=Y(this.data,I,"time","forword")-this.linkInfo.minIndex,e=this.rectMain.left+i*(this.linkInfo.unitX+this.linkInfo.spaceX)+Math.floor(this.linkInfo.unitX/2);e>this.rectMain.left&&e<this.rectMain.left+this.rectMain.width-4*this.scale&&(c=this.color.vol,a=Object(X.d)(this.sourceSeer,"buy",t),M=this.rectMain.top+Math.round((this.maxmin.max-a)*this.maxmin.unitY),Object(h.o)(o,[102,202])?(c=this.color.green,a=Object(X.d)(this.sourceSeer,"stoploss",t),M=this.rectMain.top+Math.round((this.maxmin.max-a)*this.maxmin.unitY)):Object(h.o)(o,[101,201])?(c=this.color.red,a=Object(X.d)(this.sourceSeer,"target",t),M=this.rectMain.top+Math.round((this.maxmin.max-a)*this.maxmin.unitY)):Object(h.o)(o,[300])&&(c=this.color.txt),D(this.context,e,M,{r:3*this.scale,clr:c}))}}filterSeer(){const t={};for(let i=0;i<this.sourceSeer.value.length;i++){const e=Object(X.d)(this.sourceSeer,"start",i);let s=Y(this.data,e,"time","forword");-1===s&&(s=this.linkInfo.maxIndex),void 0===t[s]&&(t[s]={nos:[],uids:[]}),t[s].name="SEER"+s,t[s].date=Object(X.d)(this.data,"time",s),t[s].nos.push(i),t[s].uids.push(Object(X.d)(this.sourceSeer,"uid",i)),Object(h.o)(Object(X.d)(this.sourceSeer,"uid",i),this.hotSeer.value)&&(t[s].focused=!0,t[s].hotIdx=i)}return t}beforeLocation(){this.linkInfo.rightMode="forword",this.data=this.source.getData(this.father.hotKey);const t=this.data.value[this.data.value.length-1][this.data.fields.time];if(this.sourceSeer=this.source.getData("SEER"),this.hotSeer=this.source.getData("SEERHOT"),this.sourceSeer.value.length<1)return 0;if(void 0===this.hotSeer&&(this.hotSeer={value:[Object(X.d)(this.sourceSeer,"uid",0)]}),this.sourceSeer.value.length<1)return 0;const i={max:Object(X.d)(this.sourceSeer,"start",0),min:Object(X.d)(this.sourceSeer,"start",this.sourceSeer.value.length-1)},e=this.source.getData("RIGHT");if(void 0!==e){const s=Object(h.a)(this.sourceSeer.value);for(let h=0;h<s.length;h++)s[h][Et.buy]=Object(X.i)(i.min,t,s[h][Et.buy],1,e.value),s[h][Et.target]=Object(X.i)(i.min,t,s[h][Et.target],1,e.value),s[h][Et.stoploss]=Object(X.i)(i.min,t,s[h][Et.stoploss],1,e.value);this.sourceSeer={key:"SEER",fields:Et,value:s}}this.showSeer=this.filterSeer();for(const t in this.showSeer)this.showSeer[t].chart=this.father.createButton(this.showSeer[t].name),i.max=i.max<this.showSeer[t].date?this.showSeer[t].date:i.max,i.min=i.min>this.showSeer[t].date?this.showSeer[t].date:i.min;this.hotKey="SEERDAY",this.data={key:"SEERDAY",fields:st.FIELD_DAY,value:this.data.value},this.linkInfo.showMode="fixed",this.linkInfo.fixed.min=i.min,this.linkInfo.fixed.max=i.max}drawTransRect(t,i){if(i<t)return;const e=T(this.color.grid,.5);d(this.context,t,this.rectMain.top,i-t,this.rectMain.height,e)}onPaint(t){for(const t in this.showSeer){let i;if(this.showSeer[t].uids.length<1)continue;1===this.showSeer[t].uids.length&&(i=Object(X.d)(this.sourceSeer,"buy",this.showSeer[t].nos[0])),!0===this.showSeer[t].focused&&(this.father.setHotButton(this.showSeer[t].chart),1===this.hotSeer.value.length&&(i=Object(X.d)(this.sourceSeer,"buy",this.showSeer[t].hotIdx)));const e=this.getSeerPos(t,i);let s="*";this.showSeer[t].uids.length<10&&(s=this.showSeer[t].uids.length.toString());const o=this.layout.symbol.size/2;this.showSeer[t].chart.init({rectMain:{left:e.xx-o,top:this.showSeer[t].focused?e.yy-o-2*o:e.yy-o,width:2*o,height:this.showSeer[t].focused?2*o+2*o:2*o},config:{translucent:!0,visible:e.visible,status:this.showSeer[t].focused?"focused":"enabled",shape:"set"},info:[{map:s}]},i=>{Object(h.s)(this.showSeer[t].uids,this.hotSeer.value).length>0?(this.hotSeer.value=[],this.father.callback({event:"seerclick",data:[]}),this.source.onPaint()):(this.hotSeer.value=this.showSeer[t].uids,this.father.callback({event:"seerclick",data:this.showSeer[t].uids}),this.source.onPaint())})}if(1===this.hotSeer.value.length)for(let t=0;t<this.sourceSeer.value.length;t++)Object(X.d)(this.sourceSeer,"uid",t)===this.hotSeer.value[0]&&this.drawHotSeer(t)}}}]},FIELD_SEER:Et};e.d(i,"DEF_CHART",function(){return _t}),e.d(i,"DEF_DATA",function(){return St}),e.d(i,"PLUGINS",function(){return Pt}),e.d(i,"util",function(){return At}),e.d(i,"createSingleChart",function(){return Ft}),e.d(i,"createMulChart",function(){return Rt});const _t=s,St=st,Pt=Lt,At={EV:class{constructor(){this.handlers={}}emit(t,...i){this.handlers[t]&&this.handlers[t].forEach(t=>t.apply(this,i))}emitWithScope(t,i,...e){this.handlers[t]&&this.handlers[t].forEach(t=>t.apply(i,e))}on(t,i){this.handlers[t]||(this.handlers[t]=[]),this.handlers[t].push(i)}once(t,i){const e=this;e.on(t,function s(){i.apply(this,arguments),e.removeListener(t,s)})}removeListener(t,i){if(this.handlers[t]){const e=this.handlers[t].indexOf(i);e>-1&&this.handlers[t].splice(e,1)}}removeAllListeners(t){this.handlers[t]=void 0}}};function Ft(t){const i=A(t),e=new gt(i),s=new Xt(i),h=new jt;return e.initChart(h,s),e}function Rt(t){const i=A(t),e=new Xt(i),s={};for(const h in t.charts){const t=new gt(i),o=new jt;t.initChart(o,e),s[h]=t}return s}}])});
//# sourceMappingURL=clchart.js.map